#
#Upload labs file and demographics file and merge.
omni_trigs_ldl_hdl_demo <- read.table("omni_trigs_ldl_hdl_demo.txt", header=TRUE, sep="")
some_labs <- read.table("some_labs.txt", header=TRUE, sep="")
some_labs$raw_lab_value <- some_labs$lab_value
some_labs$lab_value <- as.numeric(as.character(some_labs$lab_value))
non_numeric_lab_values <- subset(some_labs, is.na(some_labs$lab_value))
write.table(non_numeric_lab_values, "non_numeric_lab_values.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
lab_value_zero_or_neg <- subset(some_labs, some_labs$lab_value <=0)
write.table(lab_value_zero_or_neg, "lab_value_zero_or_neg.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
labs_demo_merge <- merge(some_labs, omni_trigs_ldl_hdl_demo, by=("ruid"))
#
#Tabulate age at event (lab) and stratify by ped/adult status.
labs_demo_merge$dob <- as.Date(labs_demo_merge$dob, format="%m/%d/%Y")
labs_demo_merge$lab_date <- as.Date(labs_demo_merge$lab_date, format="%m/%d/%Y")
labs_demo_merge$age <- trunc((unclass(as.Date(labs_demo_merge$lab_date) - as.Date(labs_demo_merge$dob)))/365.25)
write.table(labs_demo_merge, "labs_demo_merge.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
labs_demo_merge_ped <- subset(labs_demo_merge, labs_demo_merge$age < 20)
write.table(labs_demo_merge_ped, "labs_demo_merge_ped.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
labs_demo_merge_adult <- subset(labs_demo_merge, labs_demo_merge$age > 19)
write.table(labs_demo_merge_adult, "labs_demo_merge_adult.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
negative_age <- subset(labs_demo_merge, labs_demo_merge$age < 0)
write.table(negative_age, "negative_age.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
some_labs$numeric <- as.numeric(as.character(some_labs$lab_value))
non_numeric <- subset(some_labs, is.na(some_labs$numeric))
#
#Calculate median, mean, sd, and z-score for each individual for each lab, and create a table of outliers (adult).
labs_median_individual_adult <- aggregate(labs_demo_merge_adult$lab_value, list(labs_demo_merge_adult$ruid, labs_demo_merge_adult$lab_shortname), median, na.rm=TRUE)
labs_mean_individual_adult <- aggregate(labs_demo_merge_adult$lab_value, list(labs_demo_merge_adult$ruid, labs_demo_merge_adult$lab_shortname), mean, na.rm=TRUE)
labs_sd_individual_adult <- aggregate(labs_demo_merge_adult$lab_value, list(labs_demo_merge_adult$ruid, labs_demo_merge_adult$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_individual_adult) <- c("ruid", "lab_shortname", "median")
colnames(labs_mean_individual_adult) <- c("ruid", "lab_shortname", "mean")
colnames(labs_sd_individual_adult) <- c("ruid", "lab_shortname", "sd")
labs_median_mean_individual_adult <- merge(labs_median_individual_adult, labs_mean_individual_adult, by=c("ruid", "lab_shortname"))
labs_median_mean_sd_individual_adult <- merge(labs_median_mean_individual_adult, labs_sd_individual_adult, by=c("ruid", "lab_shortname"))
labs_median_mean_sd_z_demo_individual_adult <- merge(labs_median_mean_sd_individual_adult, labs_demo_merge_adult, by=c("ruid", "lab_shortname"))
labs_median_mean_sd_z_demo_individual_adult$z_within_individual <- (labs_median_mean_sd_z_demo_individual_adult$lab_value - labs_median_mean_sd_z_demo_individual_adult$mean)/labs_median_mean_sd_z_demo_individual_adult$sd
labs_median_mean_sd_z_demo_individual_adult <- labs_median_mean_sd_z_demo_individual_adult[order(labs_median_mean_sd_z_demo_individual_adult$lab_shortname, labs_median_mean_sd_z_demo_individual_adult$ruid),]
outliers_within_individual_adult <- subset(labs_median_mean_sd_z_demo_individual_adult, abs(labs_median_mean_sd_z_demo_individual_adult$z_within_individual) > 2.5)
outliers_within_individual_adult <- outliers_within_individual_adult[order(outliers_within_individual_adult$lab_shortname, outliers_within_individual_adult$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_adult, "labs_median_mean_sd_z_demo_individual_adult.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_within_individual_adult, "outliers_within_individual_adult.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score for each individual for each lab, and create a table of outliers (ped).
labs_median_individual_ped <- aggregate(labs_demo_merge_ped$lab_value, list(labs_demo_merge_ped$ruid, labs_demo_merge_ped$lab_shortname), median, na.rm=TRUE)
labs_mean_individual_ped <- aggregate(labs_demo_merge_ped$lab_value, list(labs_demo_merge_ped$ruid, labs_demo_merge_ped$lab_shortname), mean, na.rm=TRUE)
labs_sd_individual_ped <- aggregate(labs_demo_merge_ped$lab_value, list(labs_demo_merge_ped$ruid, labs_demo_merge_ped$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_individual_ped) <- c("ruid", "lab_shortname", "median")
colnames(labs_mean_individual_ped) <- c("ruid", "lab_shortname", "mean")
colnames(labs_sd_individual_ped) <- c("ruid", "lab_shortname", "sd")
labs_median_mean_individual_ped <- merge(labs_median_individual_ped, labs_mean_individual_ped, by=c("ruid", "lab_shortname"))
labs_median_mean_sd_individual_ped <- merge(labs_median_mean_individual_ped, labs_sd_individual_ped, by=c("ruid", "lab_shortname"))
labs_median_mean_sd_z_demo_individual_ped <- merge(labs_median_mean_sd_individual_ped, labs_demo_merge_ped, by=c("ruid", "lab_shortname"))
labs_median_mean_sd_z_demo_individual_ped$z_within_individual <- (labs_median_mean_sd_z_demo_individual_ped$lab_value - labs_median_mean_sd_z_demo_individual_ped$mean)/labs_median_mean_sd_z_demo_individual_ped$sd
labs_median_mean_sd_z_demo_individual_ped <- labs_median_mean_sd_z_demo_individual_ped[order(labs_median_mean_sd_z_demo_individual_ped$lab_shortname, labs_median_mean_sd_z_demo_individual_ped$ruid),]
outliers_within_individual_ped <- subset(labs_median_mean_sd_z_demo_individual_ped, abs(labs_median_mean_sd_z_demo_individual_ped$z_within_individual) > 2.5)
outliers_within_individual_ped <- outliers_within_individual_ped[order(outliers_within_individual_ped$lab_shortname, outliers_within_individual_ped$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_ped, "labs_median_mean_sd_z_demo_individual_ped.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_within_individual_ped, "outliers_within_individual_ped.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians" (ped).
lab_shortname <- labs_median_mean_sd_z_demo_individual_adult$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_adult$ruid
median <- labs_median_mean_sd_z_demo_individual_adult$median
gender <- labs_median_mean_sd_z_demo_individual_adult$gender
medians_adult <- data.frame(lab_shortname, ruid, median, gender)
medians_adult_unique <- unique(medians_adult)
medians_adult_unique <- medians_adult_unique[order(medians_adult_unique$lab_shortname, medians_adult_unique$ruid),]
write.table(medians_adult_unique, "medians_adult_unique.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
lab_shortname <- labs_median_mean_sd_z_demo_individual_ped$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_ped$ruid
median <- labs_median_mean_sd_z_demo_individual_ped$median
gender <- labs_median_mean_sd_z_demo_individual_ped$gender
medians_ped <- data.frame(lab_shortname, ruid, median, gender)
medians_ped_unique <- unique(medians_ped)
medians_ped_unique <- medians_ped_unique[order(medians_ped_unique$lab_shortname, medians_ped_unique$ruid),]
write.table(medians_ped_unique, "medians_ped_unique.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score across population for each lab, and create a table of outliers (adult).
labs_median_of_medians_population_adult <- aggregate(medians_adult_unique$median, list(medians_adult_unique$lab_shortname), median, na.rm=TRUE)
labs_mean_of_medians_population_adult <- aggregate(medians_adult_unique$median, list(medians_adult_unique$lab_shortname), mean, na.rm=TRUE)
labs_sd_of_medians_population_adult <- aggregate(medians_adult_unique$median, list(medians_adult_unique$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_of_medians_population_adult) <- c("lab_shortname", "median_of_medians")
colnames(labs_mean_of_medians_population_adult) <- c("lab_shortname", "mean_of_medians")
colnames(labs_sd_of_medians_population_adult) <- c("lab_shortname", "sd_of_medians")
labs_median_mean_population_adult <- merge(labs_median_of_medians_population_adult, labs_mean_of_medians_population_adult, by=("lab_shortname"))
labs_median_mean_sd_population_adult <- merge(labs_median_mean_population_adult, labs_sd_of_medians_population_adult, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_adult <- merge(labs_median_mean_sd_z_demo_individual_adult, labs_median_mean_sd_population_adult, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_adult$z_across_population <- (labs_median_mean_sd_z_demo_individual_and_population_adult$lab_value - labs_median_mean_sd_z_demo_individual_and_population_adult$mean_of_medians)/labs_median_mean_sd_z_demo_individual_and_population_adult$sd_of_medians
labs_median_mean_sd_z_demo_individual_and_population_adult <- labs_median_mean_sd_z_demo_individual_and_population_adult[order(labs_median_mean_sd_z_demo_individual_and_population_adult$lab_shortname, labs_median_mean_sd_z_demo_individual_and_population_adult$ruid),]
outliers_across_population_adult <- subset(labs_median_mean_sd_z_demo_individual_and_population_adult, abs(labs_median_mean_sd_z_demo_individual_and_population_adult$z_across_population) > 2.5)
outliers_across_population_adult <- outliers_across_population_adult[order(outliers_across_population_adult$lab_shortname, outliers_across_population_adult$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_and_population_adult, "labs_median_mean_sd_z_demo_individual_and_population_adult.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_across_population_adult, "outliers_across_population_adult.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians". Calculate outlier median values (adult).
lab_shortname <- labs_median_mean_sd_z_demo_individual_and_population_adult$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_and_population_adult$ruid
median <- labs_median_mean_sd_z_demo_individual_and_population_adult$median
gender <- labs_median_mean_sd_z_demo_individual_and_population_adult$gender
median_of_medians <- labs_median_mean_sd_z_demo_individual_and_population_adult$median_of_medians
mean_of_medians <-labs_median_mean_sd_z_demo_individual_and_population_adult$mean_of_medians
sd_of_medians <- labs_median_mean_sd_z_demo_individual_and_population_adult$sd_of_medians
medians_adult_z <- data.frame(lab_shortname, ruid, median, gender, median_of_medians, mean_of_medians, sd_of_medians)
medians_adult_z_unique <- unique(medians_adult_z)
medians_adult_z_unique$z_of_median <- (medians_adult_z_unique$median - medians_adult_z_unique$mean_of_medians)/medians_adult_z_unique$sd_of_medians
medians_adult_z_unique <- medians_adult_z_unique[order(medians_adult_z_unique$lab_shortname, medians_adult_z_unique$ruid),]
outliers_median_adult <- subset(medians_adult_z_unique, abs(medians_adult_z_unique$z_of_median) > 2.5)
outliers_median_adult <- outliers_median_adult[order(outliers_median_adult$lab_shortname, outliers_median_adult$ruid),]
write.table(medians_adult_z_unique, "medians_adult_z_unique.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_median_adult, "outliers_median_adult.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score across population for each lab, and create a table of outliers (ped).
labs_median_of_medians_population_ped <- aggregate(medians_ped_unique$median, list(medians_ped_unique$lab_shortname), median, na.rm=TRUE)
labs_mean_of_medians_population_ped <- aggregate(medians_ped_unique$median, list(medians_ped_unique$lab_shortname), mean, na.rm=TRUE)
labs_sd_of_medians_population_ped <- aggregate(medians_ped_unique$median, list(medians_ped_unique$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_of_medians_population_ped) <- c("lab_shortname", "median_of_medians")
colnames(labs_mean_of_medians_population_ped) <- c("lab_shortname", "mean_of_medians")
colnames(labs_sd_of_medians_population_ped) <- c("lab_shortname", "sd_of_medians")
labs_median_mean_population_ped <- merge(labs_median_of_medians_population_ped, labs_mean_of_medians_population_ped, by=("lab_shortname"))
labs_median_mean_sd_population_ped <- merge(labs_median_mean_population_ped, labs_sd_of_medians_population_ped, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_ped <- merge(labs_median_mean_sd_z_demo_individual_ped, labs_median_mean_sd_population_ped, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_ped$z_across_population <- (labs_median_mean_sd_z_demo_individual_and_population_ped$lab_value - labs_median_mean_sd_z_demo_individual_and_population_ped$mean_of_medians)/labs_median_mean_sd_z_demo_individual_and_population_ped$sd_of_medians
labs_median_mean_sd_z_demo_individual_and_population_ped <- labs_median_mean_sd_z_demo_individual_and_population_ped[order(labs_median_mean_sd_z_demo_individual_and_population_ped$lab_shortname, labs_median_mean_sd_z_demo_individual_and_population_ped$ruid),]
outliers_across_population_ped <- subset(labs_median_mean_sd_z_demo_individual_and_population_ped, abs(labs_median_mean_sd_z_demo_individual_and_population_ped$z_across_population) > 2.5)
outliers_across_population_ped <- outliers_across_population_ped[order(outliers_across_population_ped$lab_shortname, outliers_across_population_ped$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_and_population_ped, "labs_median_mean_sd_z_demo_individual_and_population_ped.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_across_population_ped, "outliers_across_population_ped.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians". Calculate outlier median values (ped).
lab_shortname <- labs_median_mean_sd_z_demo_individual_and_population_ped$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_and_population_ped$ruid
median <- labs_median_mean_sd_z_demo_individual_and_population_ped$median
gender <- labs_median_mean_sd_z_demo_individual_and_population_ped$gender
median_of_medians <- labs_median_mean_sd_z_demo_individual_and_population_ped$median_of_medians
mean_of_medians <-labs_median_mean_sd_z_demo_individual_and_population_ped$mean_of_medians
sd_of_medians <- labs_median_mean_sd_z_demo_individual_and_population_ped$sd_of_medians
medians_ped_z <- data.frame(lab_shortname, ruid, median, gender, median_of_medians, mean_of_medians, sd_of_medians)
medians_ped_z_unique <- unique(medians_ped_z)
medians_ped_z_unique <- medians_ped_z_unique[order(medians_ped_z_unique$lab_shortname, medians_ped_z_unique$ruid),]
medians_ped_z_unique$z_of_median <- (medians_ped_z_unique$median - medians_ped_z_unique$mean_of_medians)/medians_ped_z_unique$sd_of_medians
outliers_median_ped <- subset(medians_ped_z_unique, abs(medians_ped_z_unique$z_of_median) > 2.5)
outliers_median_ped <- outliers_median_ped[order(outliers_median_ped$lab_shortname, outliers_median_ped$ruid),]
write.table(medians_ped_z_unique, "medians_ped_z_unique.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_median_ped, "outliers_median_ped.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Further stratify both ped and adult (individual median) files by 'gender'.
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female <- subset(labs_median_mean_sd_z_demo_individual_and_population_adult, labs_median_mean_sd_z_demo_individual_and_population_adult$gender == "F")
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male <- subset(labs_median_mean_sd_z_demo_individual_and_population_adult, labs_median_mean_sd_z_demo_individual_and_population_adult$gender == "M")
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female <- subset(labs_median_mean_sd_z_demo_individual_and_population_ped, labs_median_mean_sd_z_demo_individual_and_population_ped$gender == "F")
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male <- subset(labs_median_mean_sd_z_demo_individual_and_population_ped, labs_median_mean_sd_z_demo_individual_and_population_ped$gender == "M")
#
#Remove population medians, means, sd, and z scores, so the correct values for subpopulations can be merged with individual values, below.
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female$median_of_medians <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female$mean_of_medians <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female$sd_of_medians <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female$z_across_population <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male$median_of_medians <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male$mean_of_medians <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male$sd_of_medians <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male$z_across_population <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female$median_of_medians <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female$mean_of_medians <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female$sd_of_medians <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female$z_across_population <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male$median_of_medians <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male$mean_of_medians <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male$sd_of_medians <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male$z_across_population <- NULL
write.table(intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female, "outliers_across_population_adult_female.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male, "outliers_across_population_adult_male.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female, "outliers_across_population_ped_female.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male, "outliers_across_population_ped_male.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians" (adult).
lab_shortname <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female$lab_shortname
ruid <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female$ruid
median <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female$median
gender <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female$gender
medians_adult_female <- data.frame(lab_shortname, ruid, median, gender)
medians_adult_female_unique <- unique(medians_adult_female)
medians_adult_female_unique <- medians_adult_female_unique[order(medians_adult_female_unique$lab_shortname, medians_adult_female_unique$ruid),]
write.table(medians_adult_female_unique, "medians_adult_female_unique.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
lab_shortname <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male$lab_shortname
ruid <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male$ruid
median <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male$median
gender <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male$gender
medians_adult_male <- data.frame(lab_shortname, ruid, median, gender)
medians_adult_male_unique <- unique(medians_adult_male)
medians_adult_male_unique <- medians_adult_male_unique[order(medians_adult_male_unique$lab_shortname, medians_adult_male_unique$ruid),]
write.table(medians_adult_male_unique, "medians_adult_male_unique.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians" (ped).
lab_shortname <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female$lab_shortname
ruid <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female$ruid
median <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female$median
gender <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female$gender
medians_ped_female <- data.frame(lab_shortname, ruid, median, gender)
medians_ped_female_unique <- unique(medians_ped_female)
medians_ped_female_unique <- medians_ped_female_unique[order(medians_ped_female_unique$lab_shortname, medians_ped_female_unique$ruid),]
write.table(medians_ped_female_unique, "medians_ped_female_unique.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
lab_shortname <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male$lab_shortname
ruid <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male$ruid
median <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male$median
gender <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male$gender
medians_ped_male <- data.frame(lab_shortname, ruid, median, gender)
medians_ped_male_unique <- unique(medians_ped_male)
medians_ped_male_unique <- medians_ped_male_unique[order(medians_ped_male_unique$lab_shortname, medians_ped_male_unique$ruid),]
write.table(medians_ped_male_unique, "medians_ped_male_unique.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score across population for each lab, and create a table of outliers (adult, female).
labs_median_of_medians_population_adult_female <- aggregate(medians_adult_female_unique$median, list(medians_adult_female_unique$lab_shortname), median, na.rm=TRUE)
labs_mean_of_medians_population_adult_female <- aggregate(medians_adult_female_unique$median, list(medians_adult_female_unique$lab_shortname), mean, na.rm=TRUE)
labs_sd_of_medians_population_adult_female <- aggregate(medians_adult_female_unique$median, list(medians_adult_female_unique$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_of_medians_population_adult_female) <- c("lab_shortname", "median_of_medians")
colnames(labs_mean_of_medians_population_adult_female) <- c("lab_shortname", "mean_of_medians")
colnames(labs_sd_of_medians_population_adult_female) <- c("lab_shortname", "sd_of_medians")
labs_median_mean_population_adult_female <- merge(labs_median_of_medians_population_adult_female, labs_mean_of_medians_population_adult_female, by=("lab_shortname"))
labs_median_mean_sd_population_adult_female <- merge(labs_median_mean_population_adult_female, labs_sd_of_medians_population_adult_female, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_adult_female <- merge(intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female, labs_median_mean_sd_population_adult_female, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_adult_female$z_across_population <- (labs_median_mean_sd_z_demo_individual_and_population_adult_female$lab_value - labs_median_mean_sd_z_demo_individual_and_population_adult_female$mean_of_medians)/labs_median_mean_sd_z_demo_individual_and_population_adult_female$sd_of_medians
labs_median_mean_sd_z_demo_individual_and_population_adult_female <- labs_median_mean_sd_z_demo_individual_and_population_adult_female[order(labs_median_mean_sd_z_demo_individual_and_population_adult_female$lab_shortname, labs_median_mean_sd_z_demo_individual_and_population_adult_female$ruid),]
outliers_across_population_adult_female <- subset(labs_median_mean_sd_z_demo_individual_and_population_adult_female, abs(labs_median_mean_sd_z_demo_individual_and_population_adult_female$z_across_population) > 2.5)
outliers_across_population_adult_female <- outliers_across_population_adult_female[order(outliers_across_population_adult_female$lab_shortname, outliers_across_population_adult_female$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_and_population_adult_female, "labs_median_mean_sd_z_demo_individual_and_population_adult_female.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_across_population_adult_female, "outliers_across_population_adult_female.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians". Calculate outlier median values (adult, female).
lab_shortname <- labs_median_mean_sd_z_demo_individual_and_population_adult_female$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_and_population_adult_female$ruid
median <- labs_median_mean_sd_z_demo_individual_and_population_adult_female$median
gender <- labs_median_mean_sd_z_demo_individual_and_population_adult_female$gender
median_of_medians <- labs_median_mean_sd_z_demo_individual_and_population_adult_female$median_of_medians
mean_of_medians <-labs_median_mean_sd_z_demo_individual_and_population_adult_female$mean_of_medians
sd_of_medians <- labs_median_mean_sd_z_demo_individual_and_population_adult_female$sd_of_medians
medians_adult_female_z <- data.frame(lab_shortname, ruid, median, gender, median_of_medians, mean_of_medians, sd_of_medians)
medians_adult_female_z_unique <- unique(medians_adult_female_z)
medians_adult_female_z_unique <- medians_adult_female_z_unique[order(medians_adult_female_z_unique$lab_shortname, medians_adult_female_z_unique$ruid),]
medians_adult_female_z_unique$z_of_median <- (medians_adult_female_z_unique$median - medians_adult_female_z_unique$mean_of_medians)/medians_adult_female_z_unique$sd_of_medians
outliers_median_adult_female <- subset(medians_adult_female_z_unique, abs(medians_adult_female_z_unique$z_of_median) > 2.5)
outliers_median_adult_female <- outliers_median_adult_female[order(outliers_median_adult_female$lab_shortname, outliers_median_adult_female$ruid),]
write.table(medians_adult_female_z_unique, "medians_adult_female_z_unique.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_median_adult_female, "outliers_median_adult_female.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score across population for each lab, and create a table of outliers (adult, male).
labs_median_of_medians_population_adult_male <- aggregate(medians_adult_male_unique$median, list(medians_adult_male_unique$lab_shortname), median, na.rm=TRUE)
labs_mean_of_medians_population_adult_male <- aggregate(medians_adult_male_unique$median, list(medians_adult_male_unique$lab_shortname), mean, na.rm=TRUE)
labs_sd_of_medians_population_adult_male <- aggregate(medians_adult_male_unique$median, list(medians_adult_male_unique$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_of_medians_population_adult_male) <- c("lab_shortname", "median_of_medians")
colnames(labs_mean_of_medians_population_adult_male) <- c("lab_shortname", "mean_of_medians")
colnames(labs_sd_of_medians_population_adult_male) <- c("lab_shortname", "sd_of_medians")
labs_median_mean_population_adult_male <- merge(labs_median_of_medians_population_adult_male, labs_mean_of_medians_population_adult_male, by=("lab_shortname"))
labs_median_mean_sd_population_adult_male <- merge(labs_median_mean_population_adult_male, labs_sd_of_medians_population_adult_male, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_adult_male <- merge(intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male, labs_median_mean_sd_population_adult_male, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_adult_male$z_across_population <- (labs_median_mean_sd_z_demo_individual_and_population_adult_male$lab_value - labs_median_mean_sd_z_demo_individual_and_population_adult_male$mean_of_medians)/labs_median_mean_sd_z_demo_individual_and_population_adult_male$sd_of_medians
labs_median_mean_sd_z_demo_individual_and_population_adult_male <- labs_median_mean_sd_z_demo_individual_and_population_adult_male[order(labs_median_mean_sd_z_demo_individual_and_population_adult_male$lab_shortname, labs_median_mean_sd_z_demo_individual_and_population_adult_male$ruid),]
outliers_across_population_adult_male <- subset(labs_median_mean_sd_z_demo_individual_and_population_adult_male, abs(labs_median_mean_sd_z_demo_individual_and_population_adult_male$z_across_population) > 2.5)
outliers_across_population_adult_male <- outliers_across_population_adult_male[order(outliers_across_population_adult_male$lab_shortname, outliers_across_population_adult_male$ruid),] 
write.table(labs_median_mean_sd_z_demo_individual_and_population_adult_male, "labs_median_mean_sd_z_demo_individual_and_population_adult_male.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_across_population_adult_male, "outliers_across_population_adult_male.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians". Calculate outlier median values (adult, male).
lab_shortname <- labs_median_mean_sd_z_demo_individual_and_population_adult_male$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_and_population_adult_male$ruid
median <- labs_median_mean_sd_z_demo_individual_and_population_adult_male$median
gender <- labs_median_mean_sd_z_demo_individual_and_population_adult_male$gender
median_of_medians <- labs_median_mean_sd_z_demo_individual_and_population_adult_male$median_of_medians
mean_of_medians <-labs_median_mean_sd_z_demo_individual_and_population_adult_male$mean_of_medians
sd_of_medians <- labs_median_mean_sd_z_demo_individual_and_population_adult_male$sd_of_medians
medians_adult_male_z <- data.frame(lab_shortname, ruid, median, gender, median_of_medians, mean_of_medians, sd_of_medians)
medians_adult_male_z_unique <- unique(medians_adult_male_z)
medians_adult_male_z_unique <- medians_adult_male_z_unique[order(medians_adult_male_z_unique$lab_shortname, medians_adult_male_z_unique$ruid),]
medians_adult_male_z_unique$z_of_median <- (medians_adult_male_z_unique$median - medians_adult_male_z_unique$mean_of_medians)/medians_adult_male_z_unique$sd_of_medians
outliers_median_adult_male <- subset(medians_adult_male_z_unique, abs(medians_adult_male_z_unique$z_of_median) > 2.5)
outliers_median_adult_male <- outliers_median_adult_male[order(outliers_median_adult_male$lab_shortname, outliers_median_adult_male$ruid),]
write.table(medians_adult_male_z_unique, "medians_adult_male_z_unique.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_median_adult_male, "outliers_median_adult_male.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score across population for each lab, and create a table of outliers (ped, female).
labs_median_of_medians_population_ped_female <- aggregate(medians_ped_female_unique$median, list(medians_ped_female_unique$lab_shortname), median, na.rm=TRUE)
labs_mean_of_medians_population_ped_female <- aggregate(medians_ped_female_unique$median, list(medians_ped_female_unique$lab_shortname), mean, na.rm=TRUE)
labs_sd_of_medians_population_ped_female <- aggregate(medians_ped_female_unique$median, list(medians_ped_female_unique$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_of_medians_population_ped_female) <- c("lab_shortname", "median_of_medians")
colnames(labs_mean_of_medians_population_ped_female) <- c("lab_shortname", "mean_of_medians")
colnames(labs_sd_of_medians_population_ped_female) <- c("lab_shortname", "sd_of_medians")
labs_median_mean_population_ped_female <- merge(labs_median_of_medians_population_ped_female, labs_mean_of_medians_population_ped_female, by=("lab_shortname"))
labs_median_mean_sd_population_ped_female <- merge(labs_median_mean_population_ped_female, labs_sd_of_medians_population_ped_female, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_ped_female <- merge(intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female, labs_median_mean_sd_population_ped_female, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_ped_female$z_across_population <- (labs_median_mean_sd_z_demo_individual_and_population_ped_female$lab_value - labs_median_mean_sd_z_demo_individual_and_population_ped_female$mean_of_medians)/labs_median_mean_sd_z_demo_individual_and_population_ped_female$sd_of_medians
labs_median_mean_sd_z_demo_individual_and_population_ped_female <- labs_median_mean_sd_z_demo_individual_and_population_ped_female[order(labs_median_mean_sd_z_demo_individual_and_population_ped_female$lab_shortname, labs_median_mean_sd_z_demo_individual_and_population_ped_female$ruid),]
outliers_across_population_ped_female <- subset(labs_median_mean_sd_z_demo_individual_and_population_ped_female, abs(labs_median_mean_sd_z_demo_individual_and_population_ped_female$z_across_population) > 2.5)
outliers_across_population_ped_female <- outliers_across_population_ped_female[order(outliers_across_population_ped_female$lab_shortname, outliers_across_population_ped_female$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_and_population_ped_female, "labs_median_mean_sd_z_demo_individual_and_population_ped_female.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_across_population_ped_female, "outliers_across_population_ped_female.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians". Calculate outlier median values (ped, female).
lab_shortname <- labs_median_mean_sd_z_demo_individual_and_population_ped_female$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_and_population_ped_female$ruid
median <- labs_median_mean_sd_z_demo_individual_and_population_ped_female$median
gender <- labs_median_mean_sd_z_demo_individual_and_population_ped_female$gender
median_of_medians <- labs_median_mean_sd_z_demo_individual_and_population_ped_female$median_of_medians
mean_of_medians <-labs_median_mean_sd_z_demo_individual_and_population_ped_female$mean_of_medians
sd_of_medians <- labs_median_mean_sd_z_demo_individual_and_population_ped_female$sd_of_medians
medians_ped_female_z <- data.frame(lab_shortname, ruid, median, gender, median_of_medians, mean_of_medians, sd_of_medians)
medians_ped_female_z_unique <- unique(medians_ped_female_z)
medians_ped_female_z_unique <- medians_ped_female_z_unique[order(medians_ped_female_z_unique$lab_shortname, medians_ped_female_z_unique$ruid),]
medians_ped_female_z_unique$z_of_median <- (medians_ped_female_z_unique$median - medians_ped_female_z_unique$mean_of_medians)/medians_ped_female_z_unique$sd_of_medians
outliers_median_ped_female <- subset(medians_ped_female_z_unique, abs(medians_ped_female_z_unique$z_of_median) > 2.5)
outliers_median_ped_female <- outliers_median_ped_female[order(outliers_median_ped_female$lab_shortname, outliers_median_ped_female$ruid),]
write.table(medians_ped_female_z_unique, "medians_ped_female_z_unique.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_median_ped_female, "outliers_median_ped_female.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score across population for each lab, and create a table of outliers (ped, male).
labs_median_of_medians_population_ped_male <- aggregate(medians_ped_male_unique$median, list(medians_ped_male_unique$lab_shortname), median, na.rm=TRUE)
labs_mean_of_medians_population_ped_male <- aggregate(medians_ped_male_unique$median, list(medians_ped_male_unique$lab_shortname), mean, na.rm=TRUE)
labs_sd_of_medians_population_ped_male <- aggregate(medians_ped_male_unique$median, list(medians_ped_male_unique$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_of_medians_population_ped_male) <- c("lab_shortname", "median_of_medians")
colnames(labs_mean_of_medians_population_ped_male) <- c("lab_shortname", "mean_of_medians")
colnames(labs_sd_of_medians_population_ped_male) <- c("lab_shortname", "sd_of_medians")
labs_median_mean_population_ped_male <- merge(labs_median_of_medians_population_ped_male, labs_mean_of_medians_population_ped_male, by=("lab_shortname"))
labs_median_mean_sd_population_ped_male <- merge(labs_median_mean_population_ped_male, labs_sd_of_medians_population_ped_male, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_ped_male <- merge(intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male, labs_median_mean_sd_population_ped_male, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_ped_male$z_across_population <- (labs_median_mean_sd_z_demo_individual_and_population_ped_male$lab_value - labs_median_mean_sd_z_demo_individual_and_population_ped_male$mean_of_medians)/labs_median_mean_sd_z_demo_individual_and_population_ped_male$sd_of_medians
labs_median_mean_sd_z_demo_individual_and_population_ped_male <- labs_median_mean_sd_z_demo_individual_and_population_ped_male[order(labs_median_mean_sd_z_demo_individual_and_population_ped_male$lab_shortname, labs_median_mean_sd_z_demo_individual_and_population_ped_male$ruid),]
outliers_across_population_ped_male <- subset(labs_median_mean_sd_z_demo_individual_and_population_ped_male, abs(labs_median_mean_sd_z_demo_individual_and_population_ped_male$z_across_population) > 2.5)
outliers_across_population_ped_male <- outliers_across_population_ped_male[order(outliers_across_population_ped_male$lab_shortname, outliers_across_population_ped_male$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_and_population_ped_male, "labs_median_mean_sd_z_demo_individual_and_population_ped_male.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_across_population_ped_male, "outliers_across_population_ped_male.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians". Calculate outlier median values (ped, male).
lab_shortname <- labs_median_mean_sd_z_demo_individual_and_population_ped_male$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_and_population_ped_male$ruid
median <- labs_median_mean_sd_z_demo_individual_and_population_ped_male$median
gender <- labs_median_mean_sd_z_demo_individual_and_population_ped_male$gender
median_of_medians <- labs_median_mean_sd_z_demo_individual_and_population_ped_male$median_of_medians
mean_of_medians <-labs_median_mean_sd_z_demo_individual_and_population_ped_male$mean_of_medians
sd_of_medians <- labs_median_mean_sd_z_demo_individual_and_population_ped_male$sd_of_medians
medians_ped_male_z <- data.frame(lab_shortname, ruid, median, gender, median_of_medians, mean_of_medians, sd_of_medians)
medians_ped_male_z_unique <- unique(medians_ped_male_z)
medians_ped_male_z_unique$z_of_median <- (medians_ped_male_z_unique$median - medians_ped_male_z_unique$mean_of_medians)/medians_ped_male_z_unique$sd_of_medians
medians_ped_male_z_unique <- medians_ped_male_z_unique[order(medians_ped_male_z_unique$lab_shortname, medians_ped_male_z_unique$ruid),]
outliers_median_ped_male <- subset(medians_ped_male_z_unique, abs(medians_ped_male_z_unique$z_of_median) > 2.5)
outliers_median_ped_male <- outliers_median_ped_male[order(outliers_median_ped_male$lab_shortname, outliers_median_ped_male$ruid),]
write.table(medians_ped_male_z_unique, "medians_ped_male_z_unique.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_median_ped_male, "outliers_median_ped_male.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Plot median lab values, adult.
for(i in unique(medians_adult_unique$lab_shortname)) {
nameplot_file <- paste("Median_Adult_", i, ".pdf", sep="")
pdf(nameplot_file)
plot(medians_adult_unique[medians_adult_unique$lab_shortname == i, "median"],
main = paste("Median Adult", i))
dev.off()
}
#
#Plot median lab values, ped.
for(i in unique(medians_ped_unique$lab_shortname)) {
nameplot_file <- paste("Median_Ped_", i, ".pdf", sep="")
pdf(nameplot_file)
plot(medians_ped_unique[medians_ped_unique$lab_shortname == i, "median"],
main = paste("Median Ped", i))
dev.off()
}
#
#Histogram median lab values, adult.
for(i in unique(medians_adult_unique$lab_shortname)) {
nameplot_file <- paste("Histogram_Median_Adult_", i, ".pdf", sep="")
pdf(nameplot_file)
hist(medians_adult_unique[medians_adult_unique$lab_shortname == i, "median"],
main = paste("Histogram: Median Adult", i))
dev.off()
}
#
#Histogram median lab values, ped.
for(i in unique(medians_ped_unique$lab_shortname)) {
nameplot_file <- paste("Histogram_Median_Ped_", i, ".pdf", sep="")
pdf(nameplot_file)
hist(medians_ped_unique[medians_ped_unique$lab_shortname == i, "median"],
main = paste("Histogram: Median Ped", i))
dev.off()
}
#
#Plot median lab values, adult female.
for(i in unique(medians_adult_female_unique$lab_shortname)) {
nameplot_file <- paste("Median_Adult_Female_", i, ".pdf", sep="")
pdf(nameplot_file)
plot(medians_adult_female_unique[medians_adult_female_unique$lab_shortname == i, "median"],
main = paste("Median Adult Female", i))
dev.off()
}
#
#Plot median lab values, adult male.
for(i in unique(medians_adult_male_unique$lab_shortname)) {
nameplot_file <- paste("Median_Adult_Male_", i, ".pdf", sep="")
pdf(nameplot_file)
plot(medians_adult_male_unique[medians_adult_male_unique$lab_shortname == i, "median"],
main = paste("Median Adult Male", i))
dev.off()
}
#
#Plot median lab values, ped female.
for(i in unique(medians_ped_female_unique$lab_shortname)) {
nameplot_file <- paste("Median_Ped_Female_", i, ".pdf", sep="")
pdf(nameplot_file)
plot(medians_ped_female_unique[medians_ped_female_unique$lab_shortname == i, "median"],
main = paste("Median Ped Female", i))
dev.off()
}
#
#Plot median lab values, ped male.
for(i in unique(medians_ped_male_unique$lab_shortname)) {
nameplot_file <- paste("Median_Ped_Male_", i, ".pdf", sep="")
pdf(nameplot_file)
plot(medians_ped_male_unique[medians_ped_male_unique$lab_shortname == i, "median"],
main = paste("Median Ped Male", i))
dev.off()
}
#
#Histogram median lab values, adult female.
for(i in unique(medians_adult_female_unique$lab_shortname)) {
nameplot_file <- paste("Histogram_Median_Adult_Female_", i, ".pdf", sep="")
pdf(nameplot_file)
hist(medians_adult_female_unique[medians_adult_female_unique$lab_shortname == i, "median"],
main = paste("Histogram: Median Adult Female", i))
dev.off()
}
#
#Histogram median lab values, adult male.
for(i in unique(medians_adult_male_unique$lab_shortname)) {
nameplot_file <- paste("Histogram_Median_Adult_Male_", i, ".pdf", sep="")
pdf(nameplot_file)
hist(medians_adult_male_unique[medians_adult_male_unique$lab_shortname == i, "median"],
main = paste("Histogram: Median Adult Male", i))
dev.off()
}
#
#Histogram median lab values, ped female.
for(i in unique(medians_ped_female_unique$lab_shortname)) {
nameplot_file <- paste("Histogram_Median_Ped_Female_", i, ".pdf", sep="")
pdf(nameplot_file)
hist(medians_ped_female_unique[medians_ped_female_unique$lab_shortname == i, "median"],
main = paste("Histogram: Median Ped Female", i))
dev.off()
}
#
#Histogram median lab values, ped male.
for(i in unique(medians_ped_male_unique$lab_shortname)) {
nameplot_file <- paste("Histogram_Median_Ped_Male_", i, ".pdf", sep="")
pdf(nameplot_file)
hist(medians_ped_male_unique[medians_ped_male_unique$lab_shortname == i, "median"],
main = paste("Histogram: Median Ped Male", i))
dev.off()
}
#
#Boxplots of median lab values, adult by gender.
for(i in unique(medians_adult_unique$lab_shortname)) {
nameplot_file <- paste("Median_Adult_by_Gender_", i, ".pdf", sep="")
pdf(nameplot_file)
plot(medians_adult_unique[medians_adult_unique$lab_shortname == i, "gender"], medians_adult_unique[medians_adult_unique$lab_shortname == i, "median"],
main = paste("Median Adult by Gender", i))
dev.off()
}
#
#Boxplots of median lab values, ped by gender.
for(i in unique(medians_ped_unique$lab_shortname)) {
nameplot_file <- paste("Median_Ped_by_Gender_", i, ".pdf", sep="")
pdf(nameplot_file)
plot(medians_ped_unique[medians_ped_unique$lab_shortname == i, "gender"], medians_ped_unique[medians_ped_unique$lab_shortname == i, "median"],
main = paste("Median Ped by Gender", i))
dev.off()
}
##
##
#REPEAT PREVIOUS ANALYSIS, USING LOG OF LAB VALUES.
##
##
#Upload labs file and demographics file and merge.
omni_trigs_ldl_hdl_demo <- read.table("omni_trigs_ldl_hdl_demo.txt", header=TRUE, sep="")
some_labs_log <- read.table("some_labs.txt", header=TRUE, sep="")
some_labs_log$lab_value <- as.numeric(as.character(some_labs_log$lab_value))
some_labs_log$lab_value_log <- log(some_labs_log$lab_value)
labs_demo_merge_log <- merge(some_labs_log, omni_trigs_ldl_hdl_demo, by=("ruid"))
#
#Tabulate age at event (lab) and stratify by ped/adult status.
labs_demo_merge_log$dob <- as.Date(labs_demo_merge_log$dob, format="%m/%d/%Y")
labs_demo_merge_log$lab_date <- as.Date(labs_demo_merge_log$lab_date, format="%m/%d/%Y")
labs_demo_merge_log$age <- trunc((unclass(as.Date(labs_demo_merge_log$lab_date) - as.Date(labs_demo_merge_log$dob)))/365.25)
write.table(labs_demo_merge_log, "labs_demo_merge_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
labs_demo_merge_ped_log <- subset(labs_demo_merge_log, labs_demo_merge_log$age < 20)
write.table(labs_demo_merge_ped_log, "labs_demo_merge_ped_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
labs_demo_merge_adult_log <- subset(labs_demo_merge_log, labs_demo_merge_log$age > 19)
write.table(labs_demo_merge_adult_log, "labs_demo_merge_adult_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score for each individual for each lab, and create a table of outliers (adult).
labs_median_individual_adult_log <- aggregate(labs_demo_merge_adult_log$lab_value_log, list(labs_demo_merge_adult_log$ruid, labs_demo_merge_adult_log$lab_shortname), median, na.rm=TRUE)
labs_mean_individual_adult_log <- aggregate(labs_demo_merge_adult_log$lab_value_log, list(labs_demo_merge_adult_log$ruid, labs_demo_merge_adult_log$lab_shortname), mean, na.rm=TRUE)
labs_sd_individual_adult_log <- aggregate(labs_demo_merge_adult_log$lab_value_log, list(labs_demo_merge_adult_log$ruid, labs_demo_merge_adult_log$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_individual_adult_log) <- c("ruid", "lab_shortname", "median_log")
colnames(labs_mean_individual_adult_log) <- c("ruid", "lab_shortname", "mean_log")
colnames(labs_sd_individual_adult_log) <- c("ruid", "lab_shortname", "sd_log")
labs_median_mean_individual_adult_log <- merge(labs_median_individual_adult_log, labs_mean_individual_adult_log, by=c("ruid", "lab_shortname"))
labs_median_mean_sd_individual_adult_log <- merge(labs_median_mean_individual_adult_log, labs_sd_individual_adult_log, by=c("ruid", "lab_shortname"))
labs_median_mean_sd_z_demo_individual_adult_log <- merge(labs_median_mean_sd_individual_adult_log, labs_demo_merge_adult_log, by=c("ruid", "lab_shortname"))
labs_median_mean_sd_z_demo_individual_adult_log$z_within_individual_log <- (labs_median_mean_sd_z_demo_individual_adult_log$lab_value_log - labs_median_mean_sd_z_demo_individual_adult_log$mean_log)/labs_median_mean_sd_z_demo_individual_adult_log$sd_log
labs_median_mean_sd_z_demo_individual_adult_log <- labs_median_mean_sd_z_demo_individual_adult_log[order(labs_median_mean_sd_z_demo_individual_adult_log$lab_shortname, labs_median_mean_sd_z_demo_individual_adult_log$ruid),]
outliers_within_individual_adult_log <- subset(labs_median_mean_sd_z_demo_individual_adult_log, abs(labs_median_mean_sd_z_demo_individual_adult_log$z_within_individual_log) > 2.5)
outliers_within_individual_adult_log <- outliers_within_individual_adult_log[order(outliers_within_individual_adult_log$lab_shortname, outliers_within_individual_adult_log$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_adult_log, "labs_median_mean_sd_z_demo_individual_adult_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_within_individual_adult_log, "outliers_within_individual_adult_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score for each individual for each lab, and create a table of outliers (ped).
labs_median_individual_ped_log <- aggregate(labs_demo_merge_ped_log$lab_value_log, list(labs_demo_merge_ped_log$ruid, labs_demo_merge_ped_log$lab_shortname), median, na.rm=TRUE)
labs_mean_individual_ped_log <- aggregate(labs_demo_merge_ped_log$lab_value_log, list(labs_demo_merge_ped_log$ruid, labs_demo_merge_ped_log$lab_shortname), mean, na.rm=TRUE)
labs_sd_individual_ped_log <- aggregate(labs_demo_merge_ped_log$lab_value_log, list(labs_demo_merge_ped_log$ruid, labs_demo_merge_ped_log$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_individual_ped_log) <- c("ruid", "lab_shortname", "median_log")
colnames(labs_mean_individual_ped_log) <- c("ruid", "lab_shortname", "mean_log")
colnames(labs_sd_individual_ped_log) <- c("ruid", "lab_shortname", "sd_log")
labs_median_mean_individual_ped_log <- merge(labs_median_individual_ped_log, labs_mean_individual_ped_log, by=c("ruid", "lab_shortname"))
labs_median_mean_sd_individual_ped_log <- merge(labs_median_mean_individual_ped_log, labs_sd_individual_ped_log, by=c("ruid", "lab_shortname"))
labs_median_mean_sd_z_demo_individual_ped_log <- merge(labs_median_mean_sd_individual_ped_log, labs_demo_merge_ped_log, by=c("ruid", "lab_shortname"))
labs_median_mean_sd_z_demo_individual_ped_log$z_within_individual_log <- (labs_median_mean_sd_z_demo_individual_ped_log$lab_value_log - labs_median_mean_sd_z_demo_individual_ped_log$mean_log)/labs_median_mean_sd_z_demo_individual_ped_log$sd_log
labs_median_mean_sd_z_demo_individual_ped_log <- labs_median_mean_sd_z_demo_individual_ped_log[order(labs_median_mean_sd_z_demo_individual_ped_log$lab_shortname, labs_median_mean_sd_z_demo_individual_ped_log$ruid),]
outliers_within_individual_ped_log <- subset(labs_median_mean_sd_z_demo_individual_ped_log, abs(labs_median_mean_sd_z_demo_individual_ped_log$z_within_individual_log) > 2.5)
outliers_within_individual_ped_log <- outliers_within_individual_ped_log[order(outliers_within_individual_ped_log$lab_shortname, outliers_within_individual_ped_log$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_ped_log, "labs_median_mean_sd_z_demo_individual_ped_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_within_individual_ped_log, "outliers_within_individual_ped_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians" (ped).
lab_shortname <- labs_median_mean_sd_z_demo_individual_adult_log$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_adult_log$ruid
median_log <- labs_median_mean_sd_z_demo_individual_adult_log$median_log
gender <- labs_median_mean_sd_z_demo_individual_adult_log$gender
medians_adult_log <- data.frame(lab_shortname, ruid, median_log, gender)
medians_adult_unique_log <- unique(medians_adult_log)
medians_adult_unique_log <- medians_adult_unique_log[order(medians_adult_unique_log$lab_shortname, medians_adult_unique_log$ruid),]
write.table(medians_adult_unique_log, "medians_adult_unique_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
lab_shortname <- labs_median_mean_sd_z_demo_individual_ped_log$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_ped_log$ruid
median_log <- labs_median_mean_sd_z_demo_individual_ped_log$median_log
gender <- labs_median_mean_sd_z_demo_individual_ped_log$gender
medians_ped_log <- data.frame(lab_shortname, ruid, median_log, gender)
medians_ped_unique_log <- unique(medians_ped_log)
medians_ped_unique_log <- medians_ped_unique_log[order(medians_ped_unique_log$lab_shortname, medians_ped_unique_log$ruid),]
write.table(medians_ped_unique_log, "medians_ped_unique_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score across population for each lab, and create a table of outliers (adult).
labs_median_of_medians_population_adult_log <- aggregate(medians_adult_unique_log$median_log, list(medians_adult_unique_log$lab_shortname), median, na.rm=TRUE)
labs_mean_of_medians_population_adult_log <- aggregate(medians_adult_unique_log$median_log, list(medians_adult_unique_log$lab_shortname), mean, na.rm=TRUE)
labs_sd_of_medians_population_adult_log <- aggregate(medians_adult_unique_log$median_log, list(medians_adult_unique_log$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_of_medians_population_adult_log) <- c("lab_shortname", "median_of_medians_log")
colnames(labs_mean_of_medians_population_adult_log) <- c("lab_shortname", "mean_of_medians_log")
colnames(labs_sd_of_medians_population_adult_log) <- c("lab_shortname", "sd_of_medians_log")
labs_median_mean_population_adult_log <- merge(labs_median_of_medians_population_adult_log, labs_mean_of_medians_population_adult_log, by=("lab_shortname"))
labs_median_mean_sd_population_adult_log <- merge(labs_median_mean_population_adult_log, labs_sd_of_medians_population_adult_log, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_adult_log <- merge(labs_median_mean_sd_z_demo_individual_adult_log, labs_median_mean_sd_population_adult_log, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_adult_log$z_across_population_log <- (labs_median_mean_sd_z_demo_individual_and_population_adult_log$lab_value_log - labs_median_mean_sd_z_demo_individual_and_population_adult_log$mean_of_medians_log)/labs_median_mean_sd_z_demo_individual_and_population_adult_log$sd_of_medians_log
labs_median_mean_sd_z_demo_individual_and_population_adult_log <- labs_median_mean_sd_z_demo_individual_and_population_adult_log[order(labs_median_mean_sd_z_demo_individual_and_population_adult_log$lab_shortname, labs_median_mean_sd_z_demo_individual_and_population_adult_log$ruid),]
outliers_across_population_adult_log <- subset(labs_median_mean_sd_z_demo_individual_and_population_adult_log, abs(labs_median_mean_sd_z_demo_individual_and_population_adult_log$z_across_population_log) > 2.5)
outliers_across_population_adult_log <- outliers_across_population_adult_log[order(outliers_across_population_adult_log$lab_shortname, outliers_across_population_adult_log$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_and_population_adult_log, "labs_median_mean_sd_z_demo_individual_and_population_adult_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_across_population_adult_log, "outliers_across_population_adult_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians". Calculate outlier median values (adult).
lab_shortname <- labs_median_mean_sd_z_demo_individual_and_population_adult_log$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_and_population_adult_log$ruid
median_log <- labs_median_mean_sd_z_demo_individual_and_population_adult_log$median_log
gender <- labs_median_mean_sd_z_demo_individual_and_population_adult_log$gender
median_of_medians_log <- labs_median_mean_sd_z_demo_individual_and_population_adult_log$median_of_medians_log
mean_of_medians_log <-labs_median_mean_sd_z_demo_individual_and_population_adult_log$mean_of_medians_log
sd_of_medians_log <- labs_median_mean_sd_z_demo_individual_and_population_adult_log$sd_of_medians_log
medians_adult_z_log <- data.frame(lab_shortname, ruid, median_log, gender, median_of_medians_log, mean_of_medians_log, sd_of_medians_log)
medians_adult_z_unique_log <- unique(medians_adult_z_log)
medians_adult_z_unique_log$z_of_median_log <- (medians_adult_z_unique_log$median_log - medians_adult_z_unique_log$mean_of_medians_log)/medians_adult_z_unique_log$sd_of_medians_log
medians_adult_z_unique_log <- medians_adult_z_unique_log[order(medians_adult_z_unique_log$lab_shortname, medians_adult_z_unique_log$ruid),]
outliers_median_adult_log <- subset(medians_adult_z_unique_log, abs(medians_adult_z_unique_log$z_of_median_log) > 2.5)
outliers_median_adult_log <- outliers_median_adult_log[order(outliers_median_adult_log$lab_shortname, outliers_median_adult_log$ruid),]
write.table(medians_adult_z_unique_log, "medians_adult_z_unique_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_median_adult_log, "outliers_median_adult_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score across population for each lab, and create a table of outliers (ped).
labs_median_of_medians_population_ped_log <- aggregate(medians_ped_unique_log$median_log, list(medians_ped_unique_log$lab_shortname), median, na.rm=TRUE)
labs_mean_of_medians_population_ped_log <- aggregate(medians_ped_unique_log$median_log, list(medians_ped_unique_log$lab_shortname), mean, na.rm=TRUE)
labs_sd_of_medians_population_ped_log <- aggregate(medians_ped_unique_log$median_log, list(medians_ped_unique_log$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_of_medians_population_ped_log) <- c("lab_shortname", "median_of_medians_log")
colnames(labs_mean_of_medians_population_ped_log) <- c("lab_shortname", "mean_of_medians_log")
colnames(labs_sd_of_medians_population_ped_log) <- c("lab_shortname", "sd_of_medians_log")
labs_median_mean_population_ped_log <- merge(labs_median_of_medians_population_ped_log, labs_mean_of_medians_population_ped_log, by=("lab_shortname"))
labs_median_mean_sd_population_ped_log <- merge(labs_median_mean_population_ped_log, labs_sd_of_medians_population_ped_log, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_ped_log <- merge(labs_median_mean_sd_z_demo_individual_ped_log, labs_median_mean_sd_population_ped_log, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_ped_log$z_across_population_log <- (labs_median_mean_sd_z_demo_individual_and_population_ped_log$lab_value_log - labs_median_mean_sd_z_demo_individual_and_population_ped_log$mean_of_medians_log)/labs_median_mean_sd_z_demo_individual_and_population_ped_log$sd_of_medians_log
labs_median_mean_sd_z_demo_individual_and_population_ped_log <- labs_median_mean_sd_z_demo_individual_and_population_ped_log[order(labs_median_mean_sd_z_demo_individual_and_population_ped_log$lab_shortname, labs_median_mean_sd_z_demo_individual_and_population_ped_log$ruid),]
outliers_across_population_ped_log <- subset(labs_median_mean_sd_z_demo_individual_and_population_ped_log, abs(labs_median_mean_sd_z_demo_individual_and_population_ped_log$z_across_population_log) > 2.5)
outliers_across_population_ped_log <- outliers_across_population_ped_log[order(outliers_across_population_ped_log$lab_shortname, outliers_across_population_ped_log$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_and_population_ped_log, "labs_median_mean_sd_z_demo_individual_and_population_ped_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_across_population_ped_log, "outliers_across_population_ped_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians". Calculate outlier median values (ped).
lab_shortname <- labs_median_mean_sd_z_demo_individual_and_population_ped_log$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_and_population_ped_log$ruid
median_log <- labs_median_mean_sd_z_demo_individual_and_population_ped_log$median_log
gender <- labs_median_mean_sd_z_demo_individual_and_population_ped_log$gender
median_of_medians_log <- labs_median_mean_sd_z_demo_individual_and_population_ped_log$median_of_medians_log
mean_of_medians_log <-labs_median_mean_sd_z_demo_individual_and_population_ped_log$mean_of_medians_log
sd_of_medians_log <- labs_median_mean_sd_z_demo_individual_and_population_ped_log$sd_of_medians_log
medians_ped_z_log <- data.frame(lab_shortname, ruid, median_log, gender, median_of_medians_log, mean_of_medians_log, sd_of_medians_log)
medians_ped_z_unique_log <- unique(medians_ped_z_log)
medians_ped_z_unique_log <- medians_ped_z_unique_log[order(medians_ped_z_unique_log$lab_shortname, medians_ped_z_unique_log$ruid),]
medians_ped_z_unique_log$z_of_median_log <- (medians_ped_z_unique_log$median_log - medians_ped_z_unique_log$mean_of_medians_log)/medians_ped_z_unique_log$sd_of_medians_log
outliers_median_ped_log <- subset(medians_ped_z_unique_log, abs(medians_ped_z_unique_log$z_of_median_log) > 2.5)
outliers_median_ped_log <- outliers_median_ped_log[order(outliers_median_ped_log$lab_shortname, outliers_median_ped_log$ruid),]
write.table(medians_ped_z_unique_log, "medians_ped_z_unique_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_median_ped_log, "outliers_median_ped_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Further stratify both ped and adult (individual median) files by 'gender'.
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_log <- subset(labs_median_mean_sd_z_demo_individual_and_population_adult_log, labs_median_mean_sd_z_demo_individual_and_population_adult_log$gender == "F")
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_log <- subset(labs_median_mean_sd_z_demo_individual_and_population_adult_log, labs_median_mean_sd_z_demo_individual_and_population_adult_log$gender == "M")
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_log <- subset(labs_median_mean_sd_z_demo_individual_and_population_ped_log, labs_median_mean_sd_z_demo_individual_and_population_ped_log$gender == "F")
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_log <- subset(labs_median_mean_sd_z_demo_individual_and_population_ped_log, labs_median_mean_sd_z_demo_individual_and_population_ped_log$gender == "M")
#
#Remove population medians, means, sd, and z scores, so they correct values for subpopulations can be merged with individual values, below.
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$median_of_medians_log <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$mean_of_medians_log <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$sd_of_medians_log <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$z_across_population_log <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$median_of_medians_log <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$mean_of_medians_log <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$sd_of_medians_log <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$z_across_population_log <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$median_of_medians_log <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$mean_of_medians_log <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$sd_of_medians_log <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$z_across_population_log <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$median_of_medians_log <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$mean_of_medians_log <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$sd_of_medians_log <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$z_across_population_log <- NULL
write.table(intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_log, "outliers_across_population_adult_female_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_log, "outliers_across_population_adult_male_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_log, "outliers_across_population_ped_female_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_log, "outliers_across_population_ped_male_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians" (adult).
lab_shortname <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$lab_shortname
ruid <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$ruid
median_log <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$median
gender <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$gender
medians_adult_female_log <- data.frame(lab_shortname, ruid, median_log, gender)
medians_adult_female_unique_log <- unique(medians_adult_female_log)
medians_adult_female_unique_log <- medians_adult_female_unique_log[order(medians_adult_female_unique_log$lab_shortname, medians_adult_female_unique_log$ruid),]
write.table(medians_adult_female_unique_log, "medians_adult_female_unique_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
lab_shortname <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$lab_shortname
ruid <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$ruid
median_log <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$median_log
gender <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$gender
medians_adult_male_log <- data.frame(lab_shortname, ruid, median_log, gender)
medians_adult_male_unique_log <- unique(medians_adult_male_log)
medians_adult_male_unique_log <- medians_adult_male_unique_log[order(medians_adult_male_unique_log$lab_shortname, medians_adult_male_unique_log$ruid),]
write.table(medians_adult_male_unique_log, "medians_adult_male_unique_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians" (ped).
lab_shortname <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$lab_shortname
ruid <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$ruid
median_log <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$median
gender <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$gender
medians_ped_female_log <- data.frame(lab_shortname, ruid, median_log, gender)
medians_ped_female_unique_log <- unique(medians_ped_female_log)
medians_ped_female_unique_log <- medians_ped_female_unique_log[order(medians_ped_female_unique_log$lab_shortname, medians_ped_female_unique_log$ruid),]
write.table(medians_ped_female_unique_log, "medians_ped_female_unique_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
lab_shortname <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$lab_shortname
ruid <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$ruid
median_log <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$median_log
gender <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$gender
medians_ped_male_log <- data.frame(lab_shortname, ruid, median_log, gender)
medians_ped_male_unique_log <- unique(medians_ped_male_log)
medians_ped_male_unique_log <- medians_ped_male_unique_log[order(medians_ped_male_unique_log$lab_shortname, medians_ped_male_unique_log$ruid),]
write.table(medians_ped_male_unique_log, "medians_ped_male_unique_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score across population for each lab, and create a table of outliers (adult, female).
labs_median_of_medians_population_adult_female_log <- aggregate(medians_adult_female_unique_log$median_log, list(medians_adult_female_unique_log$lab_shortname), median, na.rm=TRUE)
labs_mean_of_medians_population_adult_female_log <- aggregate(medians_adult_female_unique_log$median_log, list(medians_adult_female_unique_log$lab_shortname), mean, na.rm=TRUE)
labs_sd_of_medians_population_adult_female_log <- aggregate(medians_adult_female_unique_log$median_log, list(medians_adult_female_unique_log$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_of_medians_population_adult_female_log) <- c("lab_shortname", "median_of_medians_log")
colnames(labs_mean_of_medians_population_adult_female_log) <- c("lab_shortname", "mean_of_medians_log")
colnames(labs_sd_of_medians_population_adult_female_log) <- c("lab_shortname", "sd_of_medians_log")
labs_median_mean_population_adult_female_log <- merge(labs_median_of_medians_population_adult_female_log, labs_mean_of_medians_population_adult_female_log, by=("lab_shortname"))
labs_median_mean_sd_population_adult_female_log <- merge(labs_median_mean_population_adult_female_log, labs_sd_of_medians_population_adult_female_log, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_adult_female_log <- merge(intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_log, labs_median_mean_sd_population_adult_female_log, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$z_across_population_log <- (labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$lab_value_log - labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$mean_of_medians_log)/labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$sd_of_medians_log
labs_median_mean_sd_z_demo_individual_and_population_adult_female_log <- labs_median_mean_sd_z_demo_individual_and_population_adult_female_log[order(labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$lab_shortname, labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$ruid),]
outliers_across_population_adult_female_log <- subset(labs_median_mean_sd_z_demo_individual_and_population_adult_female_log, abs(labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$z_across_population_log) > 2.5)
outliers_across_population_adult_female_log <- outliers_across_population_adult_female_log[order(outliers_across_population_adult_female_log$lab_shortname, outliers_across_population_adult_female_log$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_and_population_adult_female_log, "labs_median_mean_sd_z_demo_individual_and_population_adult_female_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_across_population_adult_female_log, "outliers_across_population_adult_female_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians". Calculate outlier median values (adult, female).
lab_shortname <- labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$ruid
median_log <- labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$median_log
gender <- labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$gender
median_of_medians_log <- labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$median_of_medians_log
mean_of_medians_log <-labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$mean_of_medians_log
sd_of_medians_log <- labs_median_mean_sd_z_demo_individual_and_population_adult_female_log$sd_of_medians_log
medians_adult_female_z_log <- data.frame(lab_shortname, ruid, median_log, gender, median_of_medians_log, mean_of_medians_log, sd_of_medians_log)
medians_adult_female_z_unique_log <- unique(medians_adult_female_z_log)
medians_adult_female_z_unique_log <- medians_adult_female_z_unique_log[order(medians_adult_female_z_unique_log$lab_shortname, medians_adult_female_z_unique_log$ruid),]
medians_adult_female_z_unique_log$z_of_median_log <- (medians_adult_female_z_unique_log$median_log - medians_adult_female_z_unique_log$mean_of_medians_log)/medians_adult_female_z_unique_log$sd_of_medians_log
outliers_median_adult_female_log <- subset(medians_adult_female_z_unique_log, abs(medians_adult_female_z_unique_log$z_of_median_log) > 2.5)
outliers_median_adult_female_log <- outliers_median_adult_female_log[order(outliers_median_adult_female_log$lab_shortname, outliers_median_adult_female_log$ruid),]
write.table(medians_adult_female_z_unique_log, "medians_adult_female_z_unique_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_median_adult_female_log, "outliers_median_adult_female_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score across population for each lab, and create a table of outliers (adult, male).
labs_median_of_medians_population_adult_male_log <- aggregate(medians_adult_male_unique_log$median_log, list(medians_adult_male_unique_log$lab_shortname), median, na.rm=TRUE)
labs_mean_of_medians_population_adult_male_log <- aggregate(medians_adult_male_unique_log$median_log, list(medians_adult_male_unique_log$lab_shortname), mean, na.rm=TRUE)
labs_sd_of_medians_population_adult_male_log <- aggregate(medians_adult_male_unique_log$median_log, list(medians_adult_male_unique_log$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_of_medians_population_adult_male_log) <- c("lab_shortname", "median_of_medians_log")
colnames(labs_mean_of_medians_population_adult_male_log) <- c("lab_shortname", "mean_of_medians_log")
colnames(labs_sd_of_medians_population_adult_male_log) <- c("lab_shortname", "sd_of_medians_log")
labs_median_mean_population_adult_male_log <- merge(labs_median_of_medians_population_adult_male_log, labs_mean_of_medians_population_adult_male_log, by=("lab_shortname"))
labs_median_mean_sd_population_adult_male_log <- merge(labs_median_mean_population_adult_male_log, labs_sd_of_medians_population_adult_male_log, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_adult_male_log <- merge(intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_log, labs_median_mean_sd_population_adult_male_log, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$z_across_population_log <- (labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$lab_value_log - labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$mean_of_medians_log)/labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$sd_of_medians_log
labs_median_mean_sd_z_demo_individual_and_population_adult_male_log <- labs_median_mean_sd_z_demo_individual_and_population_adult_male_log[order(labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$lab_shortname, labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$ruid),]
outliers_across_population_adult_male_log <- subset(labs_median_mean_sd_z_demo_individual_and_population_adult_male_log, abs(labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$z_across_population_log) > 2.5)
outliers_across_population_adult_male_log <- outliers_across_population_adult_male_log[order(outliers_across_population_adult_male_log$lab_shortname, outliers_across_population_adult_male_log$ruid),] 
write.table(labs_median_mean_sd_z_demo_individual_and_population_adult_male_log, "labs_median_mean_sd_z_demo_individual_and_population_adult_male_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_across_population_adult_male_log, "outliers_across_population_adult_male_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians". Calculate outlier median values (adult, male).
lab_shortname <- labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$ruid
median_log <- labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$median_log
gender <- labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$gender
median_of_medians_log <- labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$median_of_medians_log
mean_of_medians_log <-labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$mean_of_medians_log
sd_of_medians_log <- labs_median_mean_sd_z_demo_individual_and_population_adult_male_log$sd_of_medians_log
medians_adult_male_z_log <- data.frame(lab_shortname, ruid, median_log, gender, median_of_medians_log, mean_of_medians_log, sd_of_medians_log)
medians_adult_male_z_unique_log <- unique(medians_adult_male_z_log)
medians_adult_male_z_unique_log <- medians_adult_male_z_unique_log[order(medians_adult_male_z_unique_log$lab_shortname, medians_adult_male_z_unique_log$ruid),]
medians_adult_male_z_unique_log$z_of_median_log <- (medians_adult_male_z_unique_log$median_log - medians_adult_male_z_unique_log$mean_of_medians_log)/medians_adult_male_z_unique_log$sd_of_medians_log
outliers_median_adult_male_log <- subset(medians_adult_male_z_unique_log, abs(medians_adult_male_z_unique_log$z_of_median_log) > 2.5)
outliers_median_adult_male_log <- outliers_median_adult_male_log[order(outliers_median_adult_male_log$lab_shortname, outliers_median_adult_male_log$ruid),]
write.table(medians_adult_male_z_unique_log, "medians_adult_male_z_unique_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_median_adult_male_log, "outliers_median_adult_male_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score across population for each lab, and create a table of outliers (ped, female).
labs_median_of_medians_population_ped_female_log <- aggregate(medians_ped_female_unique_log$median_log, list(medians_ped_female_unique_log$lab_shortname), median, na.rm=TRUE)
labs_mean_of_medians_population_ped_female_log <- aggregate(medians_ped_female_unique_log$median_log, list(medians_ped_female_unique_log$lab_shortname), mean, na.rm=TRUE)
labs_sd_of_medians_population_ped_female_log <- aggregate(medians_ped_female_unique_log$median_log, list(medians_ped_female_unique_log$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_of_medians_population_ped_female_log) <- c("lab_shortname", "median_of_medians_log")
colnames(labs_mean_of_medians_population_ped_female_log) <- c("lab_shortname", "mean_of_medians_log")
colnames(labs_sd_of_medians_population_ped_female_log) <- c("lab_shortname", "sd_of_medians_log")
labs_median_mean_population_ped_female_log <- merge(labs_median_of_medians_population_ped_female_log, labs_mean_of_medians_population_ped_female_log, by=("lab_shortname"))
labs_median_mean_sd_population_ped_female_log <- merge(labs_median_mean_population_ped_female_log, labs_sd_of_medians_population_ped_female_log, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_ped_female_log <- merge(intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_log, labs_median_mean_sd_population_ped_female_log, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$z_across_population_log <- (labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$lab_value_log - labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$mean_of_medians_log)/labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$sd_of_medians_log
labs_median_mean_sd_z_demo_individual_and_population_ped_female_log <- labs_median_mean_sd_z_demo_individual_and_population_ped_female_log[order(labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$lab_shortname, labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$ruid),]
outliers_across_population_ped_female_log <- subset(labs_median_mean_sd_z_demo_individual_and_population_ped_female_log, abs(labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$z_across_population_log) > 2.5)
outliers_across_population_ped_female_log <- outliers_across_population_ped_female_log[order(outliers_across_population_ped_female_log$lab_shortname, outliers_across_population_ped_female_log$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_and_population_ped_female_log, "labs_median_mean_sd_z_demo_individual_and_population_ped_female_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_across_population_ped_female_log, "outliers_across_population_ped_female_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians". Calculate outlier median values (ped, female).
lab_shortname <- labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$ruid
median_log <- labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$median_log
gender <- labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$gender
median_of_medians_log <- labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$median_of_medians_log
mean_of_medians_log <-labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$mean_of_medians_log
sd_of_medians_log <- labs_median_mean_sd_z_demo_individual_and_population_ped_female_log$sd_of_medians_log
medians_ped_female_z_log <- data.frame(lab_shortname, ruid, median_log, gender, median_of_medians_log, mean_of_medians_log, sd_of_medians_log)
medians_ped_female_z_unique_log <- unique(medians_ped_female_z_log)
medians_ped_female_z_unique_log <- medians_ped_female_z_unique_log[order(medians_ped_female_z_unique_log$lab_shortname, medians_ped_female_z_unique_log$ruid),]
medians_ped_female_z_unique_log$z_of_median_log <- (medians_ped_female_z_unique_log$median_log - medians_ped_female_z_unique_log$mean_of_medians_log)/medians_ped_female_z_unique_log$sd_of_medians_log
outliers_median_ped_female_log <- subset(medians_ped_female_z_unique_log, abs(medians_ped_female_z_unique_log$z_of_median_log) > 2.5)
outliers_median_ped_female_log <- outliers_median_ped_female_log[order(outliers_median_ped_female_log$lab_shortname, outliers_median_ped_female_log$ruid),]
write.table(medians_ped_female_z_unique_log, "medians_ped_female_z_unique_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_median_ped_female_log, "outliers_median_ped_female_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score across population for each lab, and create a table of outliers (ped, male).
labs_median_of_medians_population_ped_male_log <- aggregate(medians_ped_male_unique_log$median_log, list(medians_ped_male_unique_log$lab_shortname), median, na.rm=TRUE)
labs_mean_of_medians_population_ped_male_log <- aggregate(medians_ped_male_unique_log$median_log, list(medians_ped_male_unique_log$lab_shortname), mean, na.rm=TRUE)
labs_sd_of_medians_population_ped_male_log <- aggregate(medians_ped_male_unique_log$median_log, list(medians_ped_male_unique_log$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_of_medians_population_ped_male_log) <- c("lab_shortname", "median_of_medians_log")
colnames(labs_mean_of_medians_population_ped_male_log) <- c("lab_shortname", "mean_of_medians_log")
colnames(labs_sd_of_medians_population_ped_male_log) <- c("lab_shortname", "sd_of_medians_log")
labs_median_mean_population_ped_male_log <- merge(labs_median_of_medians_population_ped_male_log, labs_mean_of_medians_population_ped_male_log, by=("lab_shortname"))
labs_median_mean_sd_population_ped_male_log <- merge(labs_median_mean_population_ped_male_log, labs_sd_of_medians_population_ped_male_log, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_ped_male_log <- merge(intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_log, labs_median_mean_sd_population_ped_male_log, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$z_across_population_log <- (labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$lab_value_log - labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$mean_of_medians_log)/labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$sd_of_medians_log
labs_median_mean_sd_z_demo_individual_and_population_ped_male_log <- labs_median_mean_sd_z_demo_individual_and_population_ped_male_log[order(labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$lab_shortname, labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$ruid),]
outliers_across_population_ped_male_log <- subset(labs_median_mean_sd_z_demo_individual_and_population_ped_male_log, abs(labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$z_across_population_log) > 2.5)
outliers_across_population_ped_male_log <- outliers_across_population_ped_male_log[order(outliers_across_population_ped_male_log$lab_shortname, outliers_across_population_ped_male_log$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_and_population_ped_male_log, "labs_median_mean_sd_z_demo_individual_and_population_ped_male_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_across_population_ped_male_log, "outliers_across_population_ped_male_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians". Calculate outlier median values (ped, male).
lab_shortname <- labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$ruid
median_log <- labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$median_log
gender <- labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$gender
median_of_medians_log <- labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$median_of_medians_log
mean_of_medians_log <-labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$mean_of_medians_log
sd_of_medians_log <- labs_median_mean_sd_z_demo_individual_and_population_ped_male_log$sd_of_medians_log
medians_ped_male_z_log <- data.frame(lab_shortname, ruid, median_log, gender, median_of_medians_log, mean_of_medians_log, sd_of_medians_log)
medians_ped_male_z_unique_log <- unique(medians_ped_male_z_log)
medians_ped_male_z_unique_log$z_of_median_log <- (medians_ped_male_z_unique_log$median_log - medians_ped_male_z_unique_log$mean_of_medians_log)/medians_ped_male_z_unique_log$sd_of_medians_log
medians_ped_male_z_unique_log <- medians_ped_male_z_unique_log[order(medians_ped_male_z_unique_log$lab_shortname, medians_ped_male_z_unique_log$ruid),]
outliers_median_ped_male_log <- subset(medians_ped_male_z_unique_log, abs(medians_ped_male_z_unique_log$z_of_median_log) > 2.5)
outliers_median_ped_male_log <- outliers_median_ped_male_log[order(outliers_median_ped_male_log$lab_shortname, outliers_median_ped_male_log$ruid),]
write.table(medians_ped_male_z_unique_log, "medians_ped_male_z_unique_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_median_ped_male_log, "outliers_median_ped_male_log.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Plot median lab values, adult.
for(i in unique(medians_adult_unique_log$lab_shortname)) {
nameplot_file <- paste("Median_Adult_", i, "_log", ".pdf", sep="")
pdf(nameplot_file)
plot(medians_adult_unique_log[medians_adult_unique_log$lab_shortname == i, "median_log"],
main = paste("Median Adult", i, " (log)"))
dev.off()
}
#
#Plot median lab values, ped.
for(i in unique(medians_ped_unique_log$lab_shortname)) {
nameplot_file <- paste("Median_Ped_", i, "_log", ".pdf", sep="")
pdf(nameplot_file)
plot(medians_ped_unique_log[medians_ped_unique_log$lab_shortname == i, "median_log"],
main = paste("Median Ped", i, " (log)"))
dev.off()
}
#
#Histogram median lab values, adult.
for(i in unique(medians_adult_unique_log$lab_shortname)) {
nameplot_file <- paste("Histogram_Median_Adult_", i, "_log", ".pdf", sep="")
pdf(nameplot_file)
hist(medians_adult_unique_log[medians_adult_unique_log$lab_shortname == i, "median_log"],
main = paste("Histogram: Median Adult", i, " (log)"))
dev.off()
}
#
#Histogram median lab values, ped.
for(i in unique(medians_ped_unique_log$lab_shortname)) {
nameplot_file <- paste("Histogram_Median_Ped_", i, "_log", ".pdf", sep="")
pdf(nameplot_file)
hist(medians_ped_unique_log[medians_ped_unique_log$lab_shortname == i, "median_log"],
main = paste("Histogram: Median Ped", i, " (log)"))
dev.off()
}
#
#Plot median lab values, adult female.
for(i in unique(medians_adult_female_unique_log$lab_shortname)) {
nameplot_file <- paste("Median_Adult_Female_", i, "_log", ".pdf", sep="")
pdf(nameplot_file)
plot(medians_adult_female_unique_log[medians_adult_female_unique_log$lab_shortname == i, "median_log"],
main = paste("Median Adult Female", i, " (log)"))
dev.off()
}
#
#Plot median lab values, adult male.
for(i in unique(medians_adult_male_unique_log$lab_shortname)) {
nameplot_file <- paste("Median_Adult_Male_", i, "_log", ".pdf", sep="")
pdf(nameplot_file)
plot(medians_adult_male_unique_log[medians_adult_male_unique_log$lab_shortname == i, "median_log"],
main = paste("Median Adult Male", i, " (log)"))
dev.off()
}
#
#Plot median lab values, ped female.
for(i in unique(medians_ped_female_unique_log$lab_shortname)) {
nameplot_file <- paste("Median_Ped_Female_", i, "_log", ".pdf", sep="")
pdf(nameplot_file)
plot(medians_ped_female_unique_log[medians_ped_female_unique_log$lab_shortname == i, "median_log"],
main = paste("Median Ped Female", i, " (log)"))
dev.off()
}
#
#Plot median lab values, ped male.
for(i in unique(medians_ped_male_unique_log$lab_shortname)) {
nameplot_file <- paste("Median_Ped_Male_", i, "_log", ".pdf", sep="")
pdf(nameplot_file)
plot(medians_ped_male_unique_log[medians_ped_male_unique_log$lab_shortname == i, "median_log"],
main = paste("Median Ped Male", i, " (log)"))
dev.off()
}
#
#Histogram median lab values, adult female.
for(i in unique(medians_adult_female_unique_log$lab_shortname)) {
nameplot_file <- paste("Histogram_Median_Adult_Female_", i, "_log", ".pdf", sep="")
pdf(nameplot_file)
hist(medians_adult_female_unique_log[medians_adult_female_unique_log$lab_shortname == i, "median_log"],
main = paste("Histogram: Median Adult Female", i, " (log)"))
dev.off()
}
#
#Histogram median lab values, adult male.
for(i in unique(medians_adult_male_unique_log$lab_shortname)) {
nameplot_file <- paste("Histogram_Median_Adult_Male_", i, "_log", ".pdf", sep="")
pdf(nameplot_file)
hist(medians_adult_male_unique_log[medians_adult_male_unique_log$lab_shortname == i, "median_log"],
main = paste("Histogram: Median Adult Male", i, " (log)"))
dev.off()
}
#
#Histogram median lab values, ped female.
for(i in unique(medians_ped_female_unique_log$lab_shortname)) {
nameplot_file <- paste("Histogram_Median_Ped_Female_", i, "_log", ".pdf", sep="")
pdf(nameplot_file)
hist(medians_ped_female_unique_log[medians_ped_female_unique_log$lab_shortname == i, "median_log"],
main = paste("Histogram: Median Ped Female", i, " (log)"))
dev.off()
}
#
#Histogram median lab values, ped male.
for(i in unique(medians_ped_male_unique_log$lab_shortname)) {
nameplot_file <- paste("Histogram_Median_Ped_Male_", i, "_log", ".pdf", sep="")
pdf(nameplot_file)
hist(medians_ped_male_unique_log[medians_ped_male_unique_log$lab_shortname == i, "median_log"],
main = paste("Histogram: Median Ped Male", i, " (log)"))
dev.off()
}
#
#Boxplots of median lab values, adult by gender.
for(i in unique(medians_adult_unique_log$lab_shortname)) {
nameplot_file <- paste("Median_Adult_by_Gender_", i, "_log", ".pdf", sep="")
pdf(nameplot_file)
plot(medians_adult_unique[medians_adult_unique_log$lab_shortname == i, "gender"], medians_adult_unique_log[medians_adult_unique_log$lab_shortname == i, "median_log"],
main = paste("Median Adult by Gender", i, " (log)"))
dev.off()
}
#
#Boxplots of median lab values, ped by gender.
for(i in unique(medians_ped_unique_log$lab_shortname)) {
nameplot_file <- paste("Median_Ped_by_Gender_", i, "_log", ".pdf", sep="")
pdf(nameplot_file)
plot(medians_ped_unique_log[medians_ped_unique_log$lab_shortname == i, "gender"], medians_ped_unique_log[medians_ped_unique_log$lab_shortname == i, "median_log"],
main = paste("Median Ped by Gender", i, " (log)"))
dev.off()
}
##
##
#REPEAT PREVIOUS ANALYSIS, USING SQRT OF LAB VALUES.
##
##
#Upload labs file and demographics file and merge.
omni_trigs_ldl_hdl_demo <- read.table("omni_trigs_ldl_hdl_demo.txt", header=TRUE, sep="")
some_labs_sqrt <- read.table("some_labs.txt", header=TRUE, sep="")
some_labs_sqrt$lab_value <- as.numeric(as.character(some_labs_sqrt$lab_value))
some_labs_sqrt$lab_value_sqrt <- sqrt(some_labs_sqrt$lab_value)
labs_demo_merge_sqrt <- merge(some_labs_sqrt, omni_trigs_ldl_hdl_demo, by=("ruid"))
#
#Tabulate age at event (lab) and stratify by ped/adult status.
labs_demo_merge_sqrt$dob <- as.Date(labs_demo_merge_sqrt$dob, format="%m/%d/%Y")
labs_demo_merge_sqrt$lab_date <- as.Date(labs_demo_merge_sqrt$lab_date, format="%m/%d/%Y")
labs_demo_merge_sqrt$age <- trunc((unclass(as.Date(labs_demo_merge_sqrt$lab_date) - as.Date(labs_demo_merge_sqrt$dob)))/365.25)
write.table(labs_demo_merge_sqrt, "labs_demo_merge_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
labs_demo_merge_ped_sqrt <- subset(labs_demo_merge_sqrt, labs_demo_merge_sqrt$age < 20)
write.table(labs_demo_merge_ped_sqrt, "labs_demo_merge_ped_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
labs_demo_merge_adult_sqrt <- subset(labs_demo_merge_sqrt, labs_demo_merge_sqrt$age > 19)
write.table(labs_demo_merge_adult_sqrt, "labs_demo_merge_adult_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score for each individual for each lab, and create a table of outliers (adult).
labs_median_individual_adult_sqrt <- aggregate(labs_demo_merge_adult_sqrt$lab_value_sqrt, list(labs_demo_merge_adult_sqrt$ruid, labs_demo_merge_adult_sqrt$lab_shortname), median, na.rm=TRUE)
labs_mean_individual_adult_sqrt <- aggregate(labs_demo_merge_adult_sqrt$lab_value_sqrt, list(labs_demo_merge_adult_sqrt$ruid, labs_demo_merge_adult_sqrt$lab_shortname), mean, na.rm=TRUE)
labs_sd_individual_adult_sqrt <- aggregate(labs_demo_merge_adult_sqrt$lab_value_sqrt, list(labs_demo_merge_adult_sqrt$ruid, labs_demo_merge_adult_sqrt$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_individual_adult_sqrt) <- c("ruid", "lab_shortname", "median_sqrt")
colnames(labs_mean_individual_adult_sqrt) <- c("ruid", "lab_shortname", "mean_sqrt")
colnames(labs_sd_individual_adult_sqrt) <- c("ruid", "lab_shortname", "sd_sqrt")
labs_median_mean_individual_adult_sqrt <- merge(labs_median_individual_adult_sqrt, labs_mean_individual_adult_sqrt, by=c("ruid", "lab_shortname"))
labs_median_mean_sd_individual_adult_sqrt <- merge(labs_median_mean_individual_adult_sqrt, labs_sd_individual_adult_sqrt, by=c("ruid", "lab_shortname"))
labs_median_mean_sd_z_demo_individual_adult_sqrt <- merge(labs_median_mean_sd_individual_adult_sqrt, labs_demo_merge_adult_sqrt, by=c("ruid", "lab_shortname"))
labs_median_mean_sd_z_demo_individual_adult_sqrt$z_within_individual_sqrt <- (labs_median_mean_sd_z_demo_individual_adult_sqrt$lab_value_sqrt - labs_median_mean_sd_z_demo_individual_adult_sqrt$mean_sqrt)/labs_median_mean_sd_z_demo_individual_adult_sqrt$sd_sqrt
labs_median_mean_sd_z_demo_individual_adult_sqrt <- labs_median_mean_sd_z_demo_individual_adult_sqrt[order(labs_median_mean_sd_z_demo_individual_adult_sqrt$lab_shortname, labs_median_mean_sd_z_demo_individual_adult_sqrt$ruid),]
outliers_within_individual_adult_sqrt <- subset(labs_median_mean_sd_z_demo_individual_adult_sqrt, abs(labs_median_mean_sd_z_demo_individual_adult_sqrt$z_within_individual_sqrt) > 2.5)
outliers_within_individual_adult_sqrt <- outliers_within_individual_adult_sqrt[order(outliers_within_individual_adult_sqrt$lab_shortname, outliers_within_individual_adult_sqrt$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_adult_sqrt, "labs_median_mean_sd_z_demo_individual_adult_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_within_individual_adult_sqrt, "outliers_within_individual_adult_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score for each individual for each lab, and create a table of outliers (ped).
labs_median_individual_ped_sqrt <- aggregate(labs_demo_merge_ped_sqrt$lab_value_sqrt, list(labs_demo_merge_ped_sqrt$ruid, labs_demo_merge_ped_sqrt$lab_shortname), median, na.rm=TRUE)
labs_mean_individual_ped_sqrt <- aggregate(labs_demo_merge_ped_sqrt$lab_value_sqrt, list(labs_demo_merge_ped_sqrt$ruid, labs_demo_merge_ped_sqrt$lab_shortname), mean, na.rm=TRUE)
labs_sd_individual_ped_sqrt <- aggregate(labs_demo_merge_ped_sqrt$lab_value_sqrt, list(labs_demo_merge_ped_sqrt$ruid, labs_demo_merge_ped_sqrt$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_individual_ped_sqrt) <- c("ruid", "lab_shortname", "median_sqrt")
colnames(labs_mean_individual_ped_sqrt) <- c("ruid", "lab_shortname", "mean_sqrt")
colnames(labs_sd_individual_ped_sqrt) <- c("ruid", "lab_shortname", "sd_sqrt")
labs_median_mean_individual_ped_sqrt <- merge(labs_median_individual_ped_sqrt, labs_mean_individual_ped_sqrt, by=c("ruid", "lab_shortname"))
labs_median_mean_sd_individual_ped_sqrt <- merge(labs_median_mean_individual_ped_sqrt, labs_sd_individual_ped_sqrt, by=c("ruid", "lab_shortname"))
labs_median_mean_sd_z_demo_individual_ped_sqrt <- merge(labs_median_mean_sd_individual_ped_sqrt, labs_demo_merge_ped_sqrt, by=c("ruid", "lab_shortname"))
labs_median_mean_sd_z_demo_individual_ped_sqrt$z_within_individual_sqrt <- (labs_median_mean_sd_z_demo_individual_ped_sqrt$lab_value_sqrt - labs_median_mean_sd_z_demo_individual_ped_sqrt$mean_sqrt)/labs_median_mean_sd_z_demo_individual_ped_sqrt$sd_sqrt
labs_median_mean_sd_z_demo_individual_ped_sqrt <- labs_median_mean_sd_z_demo_individual_ped_sqrt[order(labs_median_mean_sd_z_demo_individual_ped_sqrt$lab_shortname, labs_median_mean_sd_z_demo_individual_ped_sqrt$ruid),]
outliers_within_individual_ped_sqrt <- subset(labs_median_mean_sd_z_demo_individual_ped_sqrt, abs(labs_median_mean_sd_z_demo_individual_ped_sqrt$z_within_individual_sqrt) > 2.5)
outliers_within_individual_ped_sqrt <- outliers_within_individual_ped_sqrt[order(outliers_within_individual_ped_sqrt$lab_shortname, outliers_within_individual_ped_sqrt$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_ped_sqrt, "labs_median_mean_sd_z_demo_individual_ped_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_within_individual_ped_sqrt, "outliers_within_individual_ped_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians" (ped).
lab_shortname <- labs_median_mean_sd_z_demo_individual_adult_sqrt$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_adult_sqrt$ruid
median_sqrt <- labs_median_mean_sd_z_demo_individual_adult_sqrt$median_sqrt
gender <- labs_median_mean_sd_z_demo_individual_adult_sqrt$gender
medians_adult_sqrt <- data.frame(lab_shortname, ruid, median_sqrt, gender)
medians_adult_unique_sqrt <- unique(medians_adult_sqrt)
medians_adult_unique_sqrt <- medians_adult_unique_sqrt[order(medians_adult_unique_sqrt$lab_shortname, medians_adult_unique_sqrt$ruid),]
write.table(medians_adult_unique_sqrt, "medians_adult_unique_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
lab_shortname <- labs_median_mean_sd_z_demo_individual_ped_sqrt$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_ped_sqrt$ruid
median_sqrt <- labs_median_mean_sd_z_demo_individual_ped_sqrt$median_sqrt
gender <- labs_median_mean_sd_z_demo_individual_ped_sqrt$gender
medians_ped_sqrt <- data.frame(lab_shortname, ruid, median_sqrt, gender)
medians_ped_unique_sqrt <- unique(medians_ped_sqrt)
medians_ped_unique_sqrt <- medians_ped_unique_sqrt[order(medians_ped_unique_sqrt$lab_shortname, medians_ped_unique_sqrt$ruid),]
write.table(medians_ped_unique_sqrt, "medians_ped_unique_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score across population for each lab, and create a table of outliers (adult).
labs_median_of_medians_population_adult_sqrt <- aggregate(medians_adult_unique_sqrt$median_sqrt, list(medians_adult_unique_sqrt$lab_shortname), median, na.rm=TRUE)
labs_mean_of_medians_population_adult_sqrt <- aggregate(medians_adult_unique_sqrt$median_sqrt, list(medians_adult_unique_sqrt$lab_shortname), mean, na.rm=TRUE)
labs_sd_of_medians_population_adult_sqrt <- aggregate(medians_adult_unique_sqrt$median_sqrt, list(medians_adult_unique_sqrt$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_of_medians_population_adult_sqrt) <- c("lab_shortname", "median_of_medians_sqrt")
colnames(labs_mean_of_medians_population_adult_sqrt) <- c("lab_shortname", "mean_of_medians_sqrt")
colnames(labs_sd_of_medians_population_adult_sqrt) <- c("lab_shortname", "sd_of_medians_sqrt")
labs_median_mean_population_adult_sqrt <- merge(labs_median_of_medians_population_adult_sqrt, labs_mean_of_medians_population_adult_sqrt, by=("lab_shortname"))
labs_median_mean_sd_population_adult_sqrt <- merge(labs_median_mean_population_adult_sqrt, labs_sd_of_medians_population_adult_sqrt, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt <- merge(labs_median_mean_sd_z_demo_individual_adult_sqrt, labs_median_mean_sd_population_adult_sqrt, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt$z_across_population_sqrt <- (labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt$lab_value_sqrt - labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt$mean_of_medians_sqrt)/labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt$sd_of_medians_sqrt
labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt[order(labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt$lab_shortname, labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt$ruid),]
outliers_across_population_adult_sqrt <- subset(labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt, abs(labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt$z_across_population_sqrt) > 2.5)
outliers_across_population_adult_sqrt <- outliers_across_population_adult_sqrt[order(outliers_across_population_adult_sqrt$lab_shortname, outliers_across_population_adult_sqrt$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt, "labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_across_population_adult_sqrt, "outliers_across_population_adult_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians". Calculate outlier median values (adult).
lab_shortname <- labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt$ruid
median_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt$median_sqrt
gender <- labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt$gender
median_of_medians_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt$median_of_medians_sqrt
mean_of_medians_sqrt <-labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt$mean_of_medians_sqrt
sd_of_medians_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt$sd_of_medians_sqrt
medians_adult_z_sqrt <- data.frame(lab_shortname, ruid, median_sqrt, gender, median_of_medians_sqrt, mean_of_medians_sqrt, sd_of_medians_sqrt)
medians_adult_z_unique_sqrt <- unique(medians_adult_z_sqrt)
medians_adult_z_unique_sqrt$z_of_median_sqrt <- (medians_adult_z_unique_sqrt$median_sqrt - medians_adult_z_unique_sqrt$mean_of_medians_sqrt)/medians_adult_z_unique_sqrt$sd_of_medians_sqrt
medians_adult_z_unique_sqrt <- medians_adult_z_unique_sqrt[order(medians_adult_z_unique_sqrt$lab_shortname, medians_adult_z_unique_sqrt$ruid),]
outliers_median_adult_sqrt <- subset(medians_adult_z_unique_sqrt, abs(medians_adult_z_unique_sqrt$z_of_median_sqrt) > 2.5)
outliers_median_adult_sqrt <- outliers_median_adult_sqrt[order(outliers_median_adult_sqrt$lab_shortname, outliers_median_adult_sqrt$ruid),]
write.table(medians_adult_z_unique_sqrt, "medians_adult_z_unique_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_median_adult_sqrt, "outliers_median_adult_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score across population for each lab, and create a table of outliers (ped).
labs_median_of_medians_population_ped_sqrt <- aggregate(medians_ped_unique_sqrt$median_sqrt, list(medians_ped_unique_sqrt$lab_shortname), median, na.rm=TRUE)
labs_mean_of_medians_population_ped_sqrt <- aggregate(medians_ped_unique_sqrt$median_sqrt, list(medians_ped_unique_sqrt$lab_shortname), mean, na.rm=TRUE)
labs_sd_of_medians_population_ped_sqrt <- aggregate(medians_ped_unique_sqrt$median_sqrt, list(medians_ped_unique_sqrt$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_of_medians_population_ped_sqrt) <- c("lab_shortname", "median_of_medians_sqrt")
colnames(labs_mean_of_medians_population_ped_sqrt) <- c("lab_shortname", "mean_of_medians_sqrt")
colnames(labs_sd_of_medians_population_ped_sqrt) <- c("lab_shortname", "sd_of_medians_sqrt")
labs_median_mean_population_ped_sqrt <- merge(labs_median_of_medians_population_ped_sqrt, labs_mean_of_medians_population_ped_sqrt, by=("lab_shortname"))
labs_median_mean_sd_population_ped_sqrt <- merge(labs_median_mean_population_ped_sqrt, labs_sd_of_medians_population_ped_sqrt, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt <- merge(labs_median_mean_sd_z_demo_individual_ped_sqrt, labs_median_mean_sd_population_ped_sqrt, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt$z_across_population_sqrt <- (labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt$lab_value_sqrt - labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt$mean_of_medians_sqrt)/labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt$sd_of_medians_sqrt
labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt[order(labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt$lab_shortname, labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt$ruid),]
outliers_across_population_ped_sqrt <- subset(labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt, abs(labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt$z_across_population_sqrt) > 2.5)
outliers_across_population_ped_sqrt <- outliers_across_population_ped_sqrt[order(outliers_across_population_ped_sqrt$lab_shortname, outliers_across_population_ped_sqrt$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt, "labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_across_population_ped_sqrt, "outliers_across_population_ped_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians". Calculate outlier median values (ped).
lab_shortname <- labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt$ruid
median_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt$median_sqrt
gender <- labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt$gender
median_of_medians_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt$median_of_medians_sqrt
mean_of_medians_sqrt <-labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt$mean_of_medians_sqrt
sd_of_medians_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt$sd_of_medians_sqrt
medians_ped_z_sqrt <- data.frame(lab_shortname, ruid, median_sqrt, gender, median_of_medians_sqrt, mean_of_medians_sqrt, sd_of_medians_sqrt)
medians_ped_z_unique_sqrt <- unique(medians_ped_z_sqrt)
medians_ped_z_unique_sqrt <- medians_ped_z_unique_sqrt[order(medians_ped_z_unique_sqrt$lab_shortname, medians_ped_z_unique_sqrt$ruid),]
medians_ped_z_unique_sqrt$z_of_median_sqrt <- (medians_ped_z_unique_sqrt$median_sqrt - medians_ped_z_unique_sqrt$mean_of_medians_sqrt)/medians_ped_z_unique_sqrt$sd_of_medians_sqrt
outliers_median_ped_sqrt <- subset(medians_ped_z_unique_sqrt, abs(medians_ped_z_unique_sqrt$z_of_median_sqrt) > 2.5)
outliers_median_ped_sqrt <- outliers_median_ped_sqrt[order(outliers_median_ped_sqrt$lab_shortname, outliers_median_ped_sqrt$ruid),]
write.table(medians_ped_z_unique_sqrt, "medians_ped_z_unique_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_median_ped_sqrt, "outliers_median_ped_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Further stratify both ped and adult (individual median) files by 'gender'.
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt <- subset(labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt, labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt$gender == "F")
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt <- subset(labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt, labs_median_mean_sd_z_demo_individual_and_population_adult_sqrt$gender == "M")
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt <- subset(labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt, labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt$gender == "F")
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt <- subset(labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt, labs_median_mean_sd_z_demo_individual_and_population_ped_sqrt$gender == "M")
#
#Remove population medians, means, sd, and z scores, so they correct values for subpopulations can be merged with individual values, below.
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$median_of_medians_sqrt <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$mean_of_medians_sqrt <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$sd_of_medians_sqrt <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$z_across_population_sqrt <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$median_of_medians_sqrt <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$mean_of_medians_sqrt <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$sd_of_medians_sqrt <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$z_across_population_sqrt <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$median_of_medians_sqrt <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$mean_of_medians_sqrt <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$sd_of_medians_sqrt <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$z_across_population_sqrt <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$median_of_medians_sqrt <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$mean_of_medians_sqrt <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$sd_of_medians_sqrt <- NULL
intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$z_across_population_sqrt <- NULL
write.table(intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt, "outliers_across_population_adult_female_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt, "outliers_across_population_adult_male_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt, "outliers_across_population_ped_female_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt, "outliers_across_population_ped_male_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians" (adult).
lab_shortname <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$lab_shortname
ruid <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$ruid
median_sqrt <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$median
gender <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$gender
medians_adult_female_sqrt <- data.frame(lab_shortname, ruid, median_sqrt, gender)
medians_adult_female_unique_sqrt <- unique(medians_adult_female_sqrt)
medians_adult_female_unique_sqrt <- medians_adult_female_unique_sqrt[order(medians_adult_female_unique_sqrt$lab_shortname, medians_adult_female_unique_sqrt$ruid),]
write.table(medians_adult_female_unique_sqrt, "medians_adult_female_unique_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
lab_shortname <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$lab_shortname
ruid <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$ruid
median_sqrt <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$median_sqrt
gender <- intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$gender
medians_adult_male_sqrt <- data.frame(lab_shortname, ruid, median_sqrt, gender)
medians_adult_male_unique_sqrt <- unique(medians_adult_male_sqrt)
medians_adult_male_unique_sqrt <- medians_adult_male_unique_sqrt[order(medians_adult_male_unique_sqrt$lab_shortname, medians_adult_male_unique_sqrt$ruid),]
write.table(medians_adult_male_unique_sqrt, "medians_adult_male_unique_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians" (ped).
lab_shortname <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$lab_shortname
ruid <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$ruid
median_sqrt <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$median
gender <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$gender
medians_ped_female_sqrt <- data.frame(lab_shortname, ruid, median_sqrt, gender)
medians_ped_female_unique_sqrt <- unique(medians_ped_female_sqrt)
medians_ped_female_unique_sqrt <- medians_ped_female_unique_sqrt[order(medians_ped_female_unique_sqrt$lab_shortname, medians_ped_female_unique_sqrt$ruid),]
write.table(medians_ped_female_unique_sqrt, "medians_ped_female_unique_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
lab_shortname <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$lab_shortname
ruid <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$ruid
median_sqrt <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$median_sqrt
gender <- intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$gender
medians_ped_male_sqrt <- data.frame(lab_shortname, ruid, median_sqrt, gender)
medians_ped_male_unique_sqrt <- unique(medians_ped_male_sqrt)
medians_ped_male_unique_sqrt <- medians_ped_male_unique_sqrt[order(medians_ped_male_unique_sqrt$lab_shortname, medians_ped_male_unique_sqrt$ruid),]
write.table(medians_ped_male_unique_sqrt, "medians_ped_male_unique_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score across population for each lab, and create a table of outliers (adult, female).
labs_median_of_medians_population_adult_female_sqrt <- aggregate(medians_adult_female_unique_sqrt$median_sqrt, list(medians_adult_female_unique_sqrt$lab_shortname), median, na.rm=TRUE)
labs_mean_of_medians_population_adult_female_sqrt <- aggregate(medians_adult_female_unique_sqrt$median_sqrt, list(medians_adult_female_unique_sqrt$lab_shortname), mean, na.rm=TRUE)
labs_sd_of_medians_population_adult_female_sqrt <- aggregate(medians_adult_female_unique_sqrt$median_sqrt, list(medians_adult_female_unique_sqrt$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_of_medians_population_adult_female_sqrt) <- c("lab_shortname", "median_of_medians_sqrt")
colnames(labs_mean_of_medians_population_adult_female_sqrt) <- c("lab_shortname", "mean_of_medians_sqrt")
colnames(labs_sd_of_medians_population_adult_female_sqrt) <- c("lab_shortname", "sd_of_medians_sqrt")
labs_median_mean_population_adult_female_sqrt <- merge(labs_median_of_medians_population_adult_female_sqrt, labs_mean_of_medians_population_adult_female_sqrt, by=("lab_shortname"))
labs_median_mean_sd_population_adult_female_sqrt <- merge(labs_median_mean_population_adult_female_sqrt, labs_sd_of_medians_population_adult_female_sqrt, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt <- merge(intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt, labs_median_mean_sd_population_adult_female_sqrt, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$z_across_population_sqrt <- (labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$lab_value_sqrt - labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$mean_of_medians_sqrt)/labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$sd_of_medians_sqrt
labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt[order(labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$lab_shortname, labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$ruid),]
outliers_across_population_adult_female_sqrt <- subset(labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt, abs(labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$z_across_population_sqrt) > 2.5)
outliers_across_population_adult_female_sqrt <- outliers_across_population_adult_female_sqrt[order(outliers_across_population_adult_female_sqrt$lab_shortname, outliers_across_population_adult_female_sqrt$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt, "labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_across_population_adult_female_sqrt, "outliers_across_population_adult_female_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians". Calculate outlier median values (adult, female).
lab_shortname <- labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$ruid
median_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$median_sqrt
gender <- labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$gender
median_of_medians_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$median_of_medians_sqrt
mean_of_medians_sqrt <-labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$mean_of_medians_sqrt
sd_of_medians_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_adult_female_sqrt$sd_of_medians_sqrt
medians_adult_female_z_sqrt <- data.frame(lab_shortname, ruid, median_sqrt, gender, median_of_medians_sqrt, mean_of_medians_sqrt, sd_of_medians_sqrt)
medians_adult_female_z_unique_sqrt <- unique(medians_adult_female_z_sqrt)
medians_adult_female_z_unique_sqrt <- medians_adult_female_z_unique_sqrt[order(medians_adult_female_z_unique_sqrt$lab_shortname, medians_adult_female_z_unique_sqrt$ruid),]
medians_adult_female_z_unique_sqrt$z_of_median_sqrt <- (medians_adult_female_z_unique_sqrt$median_sqrt - medians_adult_female_z_unique_sqrt$mean_of_medians_sqrt)/medians_adult_female_z_unique_sqrt$sd_of_medians_sqrt
outliers_median_adult_female_sqrt <- subset(medians_adult_female_z_unique_sqrt, abs(medians_adult_female_z_unique_sqrt$z_of_median_sqrt) > 2.5)
outliers_median_adult_female_sqrt <- outliers_median_adult_female_sqrt[order(outliers_median_adult_female_sqrt$lab_shortname, outliers_median_adult_female_sqrt$ruid),]
write.table(medians_adult_female_z_unique_sqrt, "medians_adult_female_z_unique_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_median_adult_female_sqrt, "outliers_median_adult_female_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score across population for each lab, and create a table of outliers (adult, male).
labs_median_of_medians_population_adult_male_sqrt <- aggregate(medians_adult_male_unique_sqrt$median_sqrt, list(medians_adult_male_unique_sqrt$lab_shortname), median, na.rm=TRUE)
labs_mean_of_medians_population_adult_male_sqrt <- aggregate(medians_adult_male_unique_sqrt$median_sqrt, list(medians_adult_male_unique_sqrt$lab_shortname), mean, na.rm=TRUE)
labs_sd_of_medians_population_adult_male_sqrt <- aggregate(medians_adult_male_unique_sqrt$median_sqrt, list(medians_adult_male_unique_sqrt$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_of_medians_population_adult_male_sqrt) <- c("lab_shortname", "median_of_medians_sqrt")
colnames(labs_mean_of_medians_population_adult_male_sqrt) <- c("lab_shortname", "mean_of_medians_sqrt")
colnames(labs_sd_of_medians_population_adult_male_sqrt) <- c("lab_shortname", "sd_of_medians_sqrt")
labs_median_mean_population_adult_male_sqrt <- merge(labs_median_of_medians_population_adult_male_sqrt, labs_mean_of_medians_population_adult_male_sqrt, by=("lab_shortname"))
labs_median_mean_sd_population_adult_male_sqrt <- merge(labs_median_mean_population_adult_male_sqrt, labs_sd_of_medians_population_adult_male_sqrt, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt <- merge(intermed_labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt, labs_median_mean_sd_population_adult_male_sqrt, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$z_across_population_sqrt <- (labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$lab_value_sqrt - labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$mean_of_medians_sqrt)/labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$sd_of_medians_sqrt
labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt[order(labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$lab_shortname, labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$ruid),]
outliers_across_population_adult_male_sqrt <- subset(labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt, abs(labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$z_across_population_sqrt) > 2.5)
outliers_across_population_adult_male_sqrt <- outliers_across_population_adult_male_sqrt[order(outliers_across_population_adult_male_sqrt$lab_shortname, outliers_across_population_adult_male_sqrt$ruid),] 
write.table(labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt, "labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_across_population_adult_male_sqrt, "outliers_across_population_adult_male_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians". Calculate outlier median values (adult, male).
lab_shortname <- labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$ruid
median_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$median_sqrt
gender <- labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$gender
median_of_medians_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$median_of_medians_sqrt
mean_of_medians_sqrt <-labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$mean_of_medians_sqrt
sd_of_medians_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_adult_male_sqrt$sd_of_medians_sqrt
medians_adult_male_z_sqrt <- data.frame(lab_shortname, ruid, median_sqrt, gender, median_of_medians_sqrt, mean_of_medians_sqrt, sd_of_medians_sqrt)
medians_adult_male_z_unique_sqrt <- unique(medians_adult_male_z_sqrt)
medians_adult_male_z_unique_sqrt <- medians_adult_male_z_unique_sqrt[order(medians_adult_male_z_unique_sqrt$lab_shortname, medians_adult_male_z_unique_sqrt$ruid),]
medians_adult_male_z_unique_sqrt$z_of_median_sqrt <- (medians_adult_male_z_unique_sqrt$median_sqrt - medians_adult_male_z_unique_sqrt$mean_of_medians_sqrt)/medians_adult_male_z_unique_sqrt$sd_of_medians_sqrt
outliers_median_adult_male_sqrt <- subset(medians_adult_male_z_unique_sqrt, abs(medians_adult_male_z_unique_sqrt$z_of_median_sqrt) > 2.5)
outliers_median_adult_male_sqrt <- outliers_median_adult_male_sqrt[order(outliers_median_adult_male_sqrt$lab_shortname, outliers_median_adult_male_sqrt$ruid),]
write.table(medians_adult_male_z_unique_sqrt, "medians_adult_male_z_unique_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_median_adult_male_sqrt, "outliers_median_adult_male_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score across population for each lab, and create a table of outliers (ped, female).
labs_median_of_medians_population_ped_female_sqrt <- aggregate(medians_ped_female_unique_sqrt$median_sqrt, list(medians_ped_female_unique_sqrt$lab_shortname), median, na.rm=TRUE)
labs_mean_of_medians_population_ped_female_sqrt <- aggregate(medians_ped_female_unique_sqrt$median_sqrt, list(medians_ped_female_unique_sqrt$lab_shortname), mean, na.rm=TRUE)
labs_sd_of_medians_population_ped_female_sqrt <- aggregate(medians_ped_female_unique_sqrt$median_sqrt, list(medians_ped_female_unique_sqrt$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_of_medians_population_ped_female_sqrt) <- c("lab_shortname", "median_of_medians_sqrt")
colnames(labs_mean_of_medians_population_ped_female_sqrt) <- c("lab_shortname", "mean_of_medians_sqrt")
colnames(labs_sd_of_medians_population_ped_female_sqrt) <- c("lab_shortname", "sd_of_medians_sqrt")
labs_median_mean_population_ped_female_sqrt <- merge(labs_median_of_medians_population_ped_female_sqrt, labs_mean_of_medians_population_ped_female_sqrt, by=("lab_shortname"))
labs_median_mean_sd_population_ped_female_sqrt <- merge(labs_median_mean_population_ped_female_sqrt, labs_sd_of_medians_population_ped_female_sqrt, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt <- merge(intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt, labs_median_mean_sd_population_ped_female_sqrt, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$z_across_population_sqrt <- (labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$lab_value_sqrt - labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$mean_of_medians_sqrt)/labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$sd_of_medians_sqrt
labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt[order(labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$lab_shortname, labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$ruid),]
outliers_across_population_ped_female_sqrt <- subset(labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt, abs(labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$z_across_population_sqrt) > 2.5)
outliers_across_population_ped_female_sqrt <- outliers_across_population_ped_female_sqrt[order(outliers_across_population_ped_female_sqrt$lab_shortname, outliers_across_population_ped_female_sqrt$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt, "labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_across_population_ped_female_sqrt, "outliers_across_population_ped_female_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians". Calculate outlier median values (ped, female).
lab_shortname <- labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$ruid
median_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$median_sqrt
gender <- labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$gender
median_of_medians_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$median_of_medians_sqrt
mean_of_medians_sqrt <-labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$mean_of_medians_sqrt
sd_of_medians_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_ped_female_sqrt$sd_of_medians_sqrt
medians_ped_female_z_sqrt <- data.frame(lab_shortname, ruid, median_sqrt, gender, median_of_medians_sqrt, mean_of_medians_sqrt, sd_of_medians_sqrt)
medians_ped_female_z_unique_sqrt <- unique(medians_ped_female_z_sqrt)
medians_ped_female_z_unique_sqrt <- medians_ped_female_z_unique_sqrt[order(medians_ped_female_z_unique_sqrt$lab_shortname, medians_ped_female_z_unique_sqrt$ruid),]
medians_ped_female_z_unique_sqrt$z_of_median_sqrt <- (medians_ped_female_z_unique_sqrt$median_sqrt - medians_ped_female_z_unique_sqrt$mean_of_medians_sqrt)/medians_ped_female_z_unique_sqrt$sd_of_medians_sqrt
outliers_median_ped_female_sqrt <- subset(medians_ped_female_z_unique_sqrt, abs(medians_ped_female_z_unique_sqrt$z_of_median_sqrt) > 2.5)
outliers_median_ped_female_sqrt <- outliers_median_ped_female_sqrt[order(outliers_median_ped_female_sqrt$lab_shortname, outliers_median_ped_female_sqrt$ruid),]
write.table(medians_ped_female_z_unique_sqrt, "medians_ped_female_z_unique_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_median_ped_female_sqrt, "outliers_median_ped_female_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Calculate median, mean, sd, and z-score across population for each lab, and create a table of outliers (ped, male).
labs_median_of_medians_population_ped_male_sqrt <- aggregate(medians_ped_male_unique_sqrt$median_sqrt, list(medians_ped_male_unique_sqrt$lab_shortname), median, na.rm=TRUE)
labs_mean_of_medians_population_ped_male_sqrt <- aggregate(medians_ped_male_unique_sqrt$median_sqrt, list(medians_ped_male_unique_sqrt$lab_shortname), mean, na.rm=TRUE)
labs_sd_of_medians_population_ped_male_sqrt <- aggregate(medians_ped_male_unique_sqrt$median_sqrt, list(medians_ped_male_unique_sqrt$lab_shortname), sd, na.rm=TRUE)
colnames(labs_median_of_medians_population_ped_male_sqrt) <- c("lab_shortname", "median_of_medians_sqrt")
colnames(labs_mean_of_medians_population_ped_male_sqrt) <- c("lab_shortname", "mean_of_medians_sqrt")
colnames(labs_sd_of_medians_population_ped_male_sqrt) <- c("lab_shortname", "sd_of_medians_sqrt")
labs_median_mean_population_ped_male_sqrt <- merge(labs_median_of_medians_population_ped_male_sqrt, labs_mean_of_medians_population_ped_male_sqrt, by=("lab_shortname"))
labs_median_mean_sd_population_ped_male_sqrt <- merge(labs_median_mean_population_ped_male_sqrt, labs_sd_of_medians_population_ped_male_sqrt, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt <- merge(intermed_labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt, labs_median_mean_sd_population_ped_male_sqrt, by=("lab_shortname"))
labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$z_across_population_sqrt <- (labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$lab_value_sqrt - labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$mean_of_medians_sqrt)/labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$sd_of_medians_sqrt
labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt[order(labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$lab_shortname, labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$ruid),]
outliers_across_population_ped_male_sqrt <- subset(labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt, abs(labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$z_across_population_sqrt) > 2.5)
outliers_across_population_ped_male_sqrt <- outliers_across_population_ped_male_sqrt[order(outliers_across_population_ped_male_sqrt$lab_shortname, outliers_across_population_ped_male_sqrt$ruid),]
write.table(labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt, "labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_across_population_ped_male_sqrt, "outliers_across_population_ped_male_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Create table of median lab values for each individual, for use in aggregation to "median of medians", "mean of medians", and "sd of medians". Calculate outlier median values (ped, male).
lab_shortname <- labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$lab_shortname
ruid <- labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$ruid
median_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$median_sqrt
gender <- labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$gender
median_of_medians_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$median_of_medians_sqrt
mean_of_medians_sqrt <-labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$mean_of_medians_sqrt
sd_of_medians_sqrt <- labs_median_mean_sd_z_demo_individual_and_population_ped_male_sqrt$sd_of_medians_sqrt
medians_ped_male_z_sqrt <- data.frame(lab_shortname, ruid, median_sqrt, gender, median_of_medians_sqrt, mean_of_medians_sqrt, sd_of_medians_sqrt)
medians_ped_male_z_unique_sqrt <- unique(medians_ped_male_z_sqrt)
medians_ped_male_z_unique_sqrt$z_of_median_sqrt <- (medians_ped_male_z_unique_sqrt$median_sqrt - medians_ped_male_z_unique_sqrt$mean_of_medians_sqrt)/medians_ped_male_z_unique_sqrt$sd_of_medians_sqrt
medians_ped_male_z_unique_sqrt <- medians_ped_male_z_unique_sqrt[order(medians_ped_male_z_unique_sqrt$lab_shortname, medians_ped_male_z_unique_sqrt$ruid),]
outliers_median_ped_male_sqrt <- subset(medians_ped_male_z_unique_sqrt, abs(medians_ped_male_z_unique_sqrt$z_of_median_sqrt) > 2.5)
outliers_median_ped_male_sqrt <- outliers_median_ped_male_sqrt[order(outliers_median_ped_male_sqrt$lab_shortname, outliers_median_ped_male_sqrt$ruid),]
write.table(medians_ped_male_z_unique_sqrt, "medians_ped_male_z_unique_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
write.table(outliers_median_ped_male_sqrt, "outliers_median_ped_male_sqrt.txt", col.names=TRUE, row.names=FALSE, quote=FALSE, sep="\t")
#
#Plot median lab values, adult.
for(i in unique(medians_adult_unique_sqrt$lab_shortname)) {
nameplot_file <- paste("Median_Adult_", i, "_sqrt", ".pdf", sep="")
pdf(nameplot_file)
plot(medians_adult_unique_sqrt[medians_adult_unique_sqrt$lab_shortname == i, "median_sqrt"],
main = paste("Median Adult", i, " (sqrt)"))
dev.off()
}
#
#Plot median lab values, ped.
for(i in unique(medians_ped_unique_sqrt$lab_shortname)) {
nameplot_file <- paste("Median_Ped_", i, "_sqrt", ".pdf", sep="")
pdf(nameplot_file)
plot(medians_ped_unique_sqrt[medians_ped_unique_sqrt$lab_shortname == i, "median_sqrt"],
main = paste("Median Ped", i, " (sqrt)"))
dev.off()
}
#
#Histogram median lab values, adult.
for(i in unique(medians_adult_unique_sqrt$lab_shortname)) {
nameplot_file <- paste("Histogram_Median_Adult_", i, "_sqrt", ".pdf", sep="")
pdf(nameplot_file)
hist(medians_adult_unique_sqrt[medians_adult_unique_sqrt$lab_shortname == i, "median_sqrt"],
main = paste("Histogram: Median Adult", i, " (sqrt)"))
dev.off()
}
#
#Histogram median lab values, ped.
for(i in unique(medians_ped_unique_sqrt$lab_shortname)) {
nameplot_file <- paste("Histogram_Median_Ped_", i, "_sqrt", ".pdf", sep="")
pdf(nameplot_file)
hist(medians_ped_unique_sqrt[medians_ped_unique_sqrt$lab_shortname == i, "median_sqrt"],
main = paste("Histogram: Median Ped", i, " (sqrt)"))
dev.off()
}
#
#Plot median lab values, adult female.
for(i in unique(medians_adult_female_unique_sqrt$lab_shortname)) {
nameplot_file <- paste("Median_Adult_Female_", i, "_sqrt", ".pdf", sep="")
pdf(nameplot_file)
plot(medians_adult_female_unique_sqrt[medians_adult_female_unique_sqrt$lab_shortname == i, "median_sqrt"],
main = paste("Median Adult Female", i, " (sqrt)"))
dev.off()
}
#
#Plot median lab values, adult male.
for(i in unique(medians_adult_male_unique_sqrt$lab_shortname)) {
nameplot_file <- paste("Median_Adult_Male_", i, "_sqrt", ".pdf", sep="")
pdf(nameplot_file)
plot(medians_adult_male_unique_sqrt[medians_adult_male_unique_sqrt$lab_shortname == i, "median_sqrt"],
main = paste("Median Adult Male", i, " (sqrt)"))
dev.off()
}
#
#Plot median lab values, ped female.
for(i in unique(medians_ped_female_unique_sqrt$lab_shortname)) {
nameplot_file <- paste("Median_Ped_Female_", i, "_sqrt", ".pdf", sep="")
pdf(nameplot_file)
plot(medians_ped_female_unique_sqrt[medians_ped_female_unique_sqrt$lab_shortname == i, "median_sqrt"],
main = paste("Median Ped Female", i, " (sqrt)"))
dev.off()
}
#
#Plot median lab values, ped male.
for(i in unique(medians_ped_male_unique_sqrt$lab_shortname)) {
nameplot_file <- paste("Median_Ped_Male_", i, "_sqrt", ".pdf", sep="")
pdf(nameplot_file)
plot(medians_ped_male_unique_sqrt[medians_ped_male_unique_sqrt$lab_shortname == i, "median_sqrt"],
main = paste("Median Ped Male", i, " (sqrt)"))
dev.off()
}
#
#Histogram median lab values, adult female.
for(i in unique(medians_adult_female_unique_sqrt$lab_shortname)) {
nameplot_file <- paste("Histogram_Median_Adult_Female_", i, "_sqrt", ".pdf", sep="")
pdf(nameplot_file)
hist(medians_adult_female_unique_sqrt[medians_adult_female_unique_sqrt$lab_shortname == i, "median_sqrt"],
main = paste("Histogram: Median Adult Female", i, " (sqrt)"))
dev.off()
}
#
#Histogram median lab values, adult male.
for(i in unique(medians_adult_male_unique_sqrt$lab_shortname)) {
nameplot_file <- paste("Histogram_Median_Adult_Male_", i, "_sqrt", ".pdf", sep="")
pdf(nameplot_file)
hist(medians_adult_male_unique_sqrt[medians_adult_male_unique_sqrt$lab_shortname == i, "median_sqrt"],
main = paste("Histogram: Median Adult Male", i, " (sqrt)"))
dev.off()
}
#
#Histogram median lab values, ped female.
for(i in unique(medians_ped_female_unique_sqrt$lab_shortname)) {
nameplot_file <- paste("Histogram_Median_Ped_Female_", i, "_sqrt", ".pdf", sep="")
pdf(nameplot_file)
hist(medians_ped_female_unique_sqrt[medians_ped_female_unique_sqrt$lab_shortname == i, "median_sqrt"],
main = paste("Histogram: Median Ped Female", i, " (sqrt)"))
dev.off()
}
#
#Histogram median lab values, ped male.
for(i in unique(medians_ped_male_unique_sqrt$lab_shortname)) {
nameplot_file <- paste("Histogram_Median_Ped_Male_", i, "_sqrt", ".pdf", sep="")
pdf(nameplot_file)
hist(medians_ped_male_unique_sqrt[medians_ped_male_unique_sqrt$lab_shortname == i, "median_sqrt"],
main = paste("Histogram: Median Ped Male", i, " (sqrt)"))
dev.off()
}
#
#Boxplots of median lab values, adult by gender.
for(i in unique(medians_adult_unique_sqrt$lab_shortname)) {
nameplot_file <- paste("Median_Adult_by_Gender_", i, "_sqrt", ".pdf", sep="")
pdf(nameplot_file)
plot(medians_adult_unique[medians_adult_unique_sqrt$lab_shortname == i, "gender"], medians_adult_unique_sqrt[medians_adult_unique_sqrt$lab_shortname == i, "median_sqrt"],
main = paste("Median Adult by Gender", i, " (sqrt)"))
dev.off()
}
#
#Boxplots of median lab values, ped by gender.
for(i in unique(medians_ped_unique_sqrt$lab_shortname)) {
nameplot_file <- paste("Median_Ped_by_Gender_", i, "_sqrt", ".pdf", sep="")
pdf(nameplot_file)
plot(medians_ped_unique_sqrt[medians_ped_unique_sqrt$lab_shortname == i, "gender"], medians_ped_unique_sqrt[medians_ped_unique_sqrt$lab_shortname == i, "median_sqrt"],
main = paste("Median Ped by Gender", i, " (sqrt)"))
dev.off()
}